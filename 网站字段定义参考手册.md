# 📖 网站字段定义参考手册

> 最后更新：2026-02-12
> 维护人：07

---

## 一、用户与权限

| 字段 | 定义 | 说明 |
|------|------|------|
| **UserRole** | 用户角色 | `manager`(经理) / `leader`(组长) / `member`(组员) |
| **username** | 用户名 | 登录账号，如 `manager`, `wjzu`, `wj01`~`wj10` |
| **display_name** | 显示姓名 | 中文名（可选） |
| **team_id** | 所属小组ID | 关联 teams 表 |

**权限说明**：
- **经理(manager)**：可查看所有团队数据、管理员工账号、同步全部数据
- **组长(leader)**：可查看本组所有成员数据、同步本组数据
- **组员(member)**：仅能查看和管理自己的数据

### 1.1 团队架构

| 小组代码 | 小组名称 | 组长账号 | 组员账号 | 密码 |
|----------|----------|----------|----------|------|
| **wj** | 文俊组 | wjzu | wj01~wj10 | wj123456 |
| **jy** | jy组 | jyzu | jy01~jy10 | jy123456 |
| **yz** | yz组 | yzzu | yz01~yz10 | yz123456 |

**经理账号**：`manager` / `m123456`

---

## 二、联盟平台代码（8个平台）

| 缩写 | 全称 | 数据库存储值 | URL |
|------|------|--------------|-----|
| **CG** | CollabGlow | `cg` | https://app.collabglow.com/ |
| **RW** | Rewardoo | `rw` | https://www.rewardoo.com/ |
| **LH** | LinkHaitao | `lh` | https://www.linkhaitao.com/ |
| **PM** | Partnermatic | `pm` | https://app.partnermatic.com |
| **LB** | Linkbux | `lb` | https://www.linkbux.com/ |
| **PB** | PartnerBoost | `pb` | https://app.partnerboost.com |
| **BSH** | BrandSparkHub | `bsh` | https://www.brandsparkhub.com/ |
| **CF** | CreatorFlare | `cf` | https://www.creatorflare.com/ |

> ✅ **标准**：所有平台使用小写缩写作为数据库存储值

---

## 三、商家/广告相关字段

| 字段 | 中文 | 定义 | 来源 |
|------|------|------|------|
| **MID** | 商家ID | 平台分配的商家唯一标识，如 `154253`, `18646457` | 见下方获取方式 |
| **merchant** | 商家名称 | 如 `Hill House Home`, `Highland` | 联盟平台API |
| **campaign_id** | 广告系列ID | Google Ads 分配的广告系列唯一标识 | Google Ads API |
| **campaign_name** | 广告系列名 | 格式通常为 `001-CG-uaudio-US-0129-18683107` | Google Ads API |
| **customer_id (CID)** | 客户ID | Google Ads 客户账号ID | Google Ads API |
| **mcc_id** | MCC账号ID | Google Ads 经理账号ID | Google Ads API |

### MID 获取方式

**获取流程**：
1. **第一步**：从 `campaign_name`（广告系列名）中提取 MID
2. **第二步**：用提取的 MID 去联盟平台交易数据中匹配

**campaign_name 格式**：
```
序号-平台-商家名-国家-日期-MID
```

**示例**：
- `001-CG-uaudio-US-0129-18683107` → MID = `18683107`
- `002-RW-revisionskincare-US-0126-116022` → MID = `116022`

**提取方法**：取广告系列名最后一段数字（通常5-6位）

### 各平台 API 返回的 MID 字段名（代码实现）

| 平台 | API 返回的 MID 字段 | 优先级 |
|------|-------------------|--------|
| **CG** | `mid`, `brand_id`, `mcid` | mid > brand_id > mcid |
| **RW** | `mid`, `brand_id`, `brandId`, `m_id`, `merchant_id` | mid > brand_id > brandId > m_id > merchant_id |
| **LH** | `m_id`, `mcid`, `brand_id`, `merchant_id` | m_id > mcid > brand_id > merchant_id |
| **PM** | `brand_id`, `mcid`, `merchant_id` | brand_id > mcid > merchant_id |
| **LB** | `mid` | 只使用 mid 字段 |
| **PB** | ⚠️ 待确认（暂无数据） | - |
| **BSH** | `brand_id`, `brandId`, `m_id`, `mcid`, `merchant_id` | 按顺序尝试 |
| **CF** | `brand_id`, `mcid`, `merchant_id` | 按顺序尝试 |

---

## 四、交易状态

| 状态值 | 中文 | 说明 |
|--------|------|------|
| **approved** | 已确认 | 佣金已确认，计入收入 |
| **pending** | 审核中 | 等待商家确认 |
| **rejected** | 已拒付 | 订单被拒，佣金不计入 |

---

## 五、Google Ads 数据字段

| 字段 | 中文 | 定义 | 单位 |
|------|------|------|------|
| **cost** | 费用/花费 | 广告消耗金额 | USD |
| **clicks** | 点击 | 广告被点击次数 | 次 |
| **impressions** | 展示 | 广告展示次数 | 次 |
| **cpc** | CPC | 每次点击成本 (Cost Per Click) = 费用 / 点击 | USD |
| **budget** | 预算 | 每日广告预算 | USD |
| **is_budget_lost** | Budget丢失 | 因预算不足丢失的展示份额 | 百分比 (0-1) |
| **is_rank_lost** | Rank丢失 | 因广告排名不足丢失的展示份额 | 百分比 (0-1) |
| **status** | 状态 | `ENABLED`(已启用) / `PAUSED`(已暂停) / `REMOVED`(已移除)，数据库存储中文显示名 | - |

---

## 六、联盟交易数据字段

| 字段 | 中文 | 定义 | 单位 |
|------|------|------|------|
| **orders** | 订单数 | 总订单数量 | 个 |
| **order_amount** | 订单金额/GMV | 订单总交易金额 | USD |
| **commission** / **commission_amount** | 佣金 | 联盟分成金额 | USD |
| **total_commission** | 总佣金 | 汇总后的佣金金额 | USD |
| **rejected_commission** | 拒付佣金 | 被拒绝的佣金金额 | USD |
| **transaction_id** | 交易ID | 平台唯一交易标识 | - |
| **transaction_time** | 交易时间 | 订单发生时间 | DateTime |

---

## 七、L7D 分析核心指标（滚动7天）

| 字段 | 中文 | 定义 | 来源 |
|------|------|------|------|
| **L7D点击** | 近7天点击 | SUM(近7天clicks) | Google Ads |
| **L7D花费** | 近7天费用 | SUM(近7天cost) | Google Ads |
| **L7D订单** | 近7天订单 | SUM(近7天orders) | 联盟平台 |
| **L7D佣金** | 近7天佣金 | SUM(近7天commission) | 联盟平台 |
| **L7D出单天数** | 近7天出单天数 | COUNT(有订单的天数) | 0-7 |
| **当前Max CPC** | 当前最高CPC | 取同一广告系列中所有已启用关键词的「最高每次点击费用」的最大值；如无关键词数据则回退到广告系列级别 CPC 最大值（仅 L7D 分析） | Google Ads 关键字级别 |

---

## 八、核心计算公式

| 指标 | 公式 | 说明 |
|------|------|------|
| **ROI** | `(佣金 - 费用) / 费用` | 投资回报率，>0盈利，<0亏损 |
| **保守EPC** | `保守佣金 / 点击` | 每次点击平均收益（已含0.72系数） |
| **保守ROI** | `(保守EPC - CPC) / CPC` | 基于保守EPC的投资回报率 |
| **红线CPC** | `保守EPC × 0.7` | CPC不应超过此值 |
| **日均点击** | `L7D点击 / 7` | 样本量判定依据 |
| **拒付率** | `拒付订单 / 总订单` | 订单被拒比例 |
| **净佣金** | `总佣金 - 拒付佣金` | 实际可获佣金 |

---

## 九、AI 报告系统

### 9.1 L7D数据分析结果

| 项目 | 说明 |
|------|------|
| **定义** | Gemini AI 根据 `excel/分析提示词_关键词版.txt` 生成的专业分析报告 |
| **存储位置** | `analysis_results` 表的 `result_data.data[].ai_report` 字段 |
| **提示词类型** | `analysis` |
| **用户自定义提示词存储** | `user_prompts` 表，`prompt_type = 'analysis'` |
| **触发方式** | 在 L7D 分析页面点击「生成报告」按钮 |

### 9.2 AI生成的分析报告

| 项目 | 说明 |
|------|------|
| **定义** | Gemini AI 生成的综合分析报告 |
| **存储位置** | `ai_reports` 表 |
| **提示词类型** | `report` |
| **用户自定义提示词存储** | `user_prompts` 表，`prompt_type = 'report'` |
| **触发方式** | 在「我的报告」页面选择日期范围后点击「生成报告」按钮 |

### 9.3 相关数据库表

| 表名 | 用途 |
|------|------|
| **ai_reports** | 存储 AI 生成的分析报告 |
| **user_prompts** | 存储用户自定义提示词（按 `prompt_type` 区分） |
| **analysis_results** | 存储 L7D 分析结果（含 `ai_report` 字段） |

---

## 十、货币与转换

| 字段 | 说明 |
|------|------|
| **currency** | 货币类型，主要为 `USD`（美元）或 `CNY`（人民币） |
| **cost_original** | 原币费用 |
| **cost_usd** | 折算为USD后的费用 |
| **CNY_TO_USD_RATE** | 人民币兑美元汇率，默认 7.2（1 USD = 7.2 CNY） |

---

## 十一、团队统计字段

### 11.1 小组统计 (TeamStatsResponse)

| 字段 | 中文 | 定义 | 计算方式 |
|------|------|------|----------|
| **team_code** | 小组代码 | 如 `wj`, `jy`, `yz` | - |
| **team_name** | 小组名称 | 如 `文俊组` | - |
| **member_count** | 成员数 | 组内普通组员数量（不含组长） | COUNT(role=member) |
| **total_cost** | 总费用 | 组内所有成员的 Google Ads 费用总和 | SUM(google_ads_api_data.cost) |
| **total_commission** | 总佣金 | 所有状态的佣金总和（含拒付） | SUM(affiliate_transactions.commission) |
| **rejected_commission** | 拒付佣金 | status='rejected' 的佣金总和 | SUM(commission WHERE status='rejected') |
| **net_commission** | 净佣金 | 实际可获佣金 | total_commission - rejected_commission |
| **total_profit** | 总利润 | 净佣金减去费用 | net_commission - total_cost |
| **avg_roi** | 平均ROI | 投资回报率 | (total_profit / total_cost) × 100% |

### 11.2 成员排行榜 (MemberRankingResponse)

| 字段 | 中文 | 定义 | 说明 |
|------|------|------|------|
| **user_id** | 用户ID | 数据库主键 | - |
| **username** | 用户名 | 登录账号 | - |
| **display_name** | 显示名 | 中文名 | - |
| **team_code** | 小组代码 | 所属小组 | - |
| **team_name** | 小组名称 | 所属小组名称 | - |
| **cost** | 费用 | 广告费用 | USD |
| **commission** | 总佣金 | 所有状态的佣金 | USD |
| **rejected_commission** | 拒付佣金 | 被拒绝的佣金 | USD |
| **net_commission** | 净佣金 | 实际可获佣金 | USD |
| **profit** | 利润 | 净佣金 - 费用 | USD |
| **roi** | ROI | 投资回报率 | % |

> **注意**：小组统计和成员排行榜仅统计**普通组员(member)**，不包含组长(leader)和经理(manager)。

---

## 十二、数据库主要表结构

| 表名 | 用途 |
|------|------|
| **users** | 用户账号（经理/组长/组员） |
| **teams** | 小组信息（wj/jy/yz组） |
| **affiliate_platforms** | 联盟平台（CG/RW/LH等） |
| **affiliate_accounts** | 联盟账号（员工在各平台的账号） |
| **affiliate_transactions** | 联盟交易记录（订单/佣金） |
| **affiliate_rejections** | 拒付详情 |
| **google_mcc_accounts** | Google MCC 账号 |
| **google_ads_api_data** | Google Ads 数据（按广告系列/日期） |
| **platform_data** | 平台数据汇总（按账号/日期） |
| **analysis_results** | L7D 分析结果 |
| **ai_reports** | AI 分析报告 |
| **user_prompts** | 用户自定义提示词 |
| **expense_adjustments** | 费用/佣金调整 |

---

## 十三、待确认/待更新项

| 项目 | 状态 | 说明 |
|------|------|------|
| PB 平台 MID 字段 | ⚠️ 待确认 | 暂无 PB 数据，等有数据后更新 |
| 各平台 MID 字段 | 📝 代码实现 | 基于代码分析，未经实际数据验证 |
| jy组/yz组中文名 | ⚠️ 待补充 | 等组长登录后自行设置 |

---

## 更新日志

| 日期 | 更新内容 |
|------|----------|
| 2026-02-12 | 新增团队统计字段（总佣金、拒付佣金、净佣金） |
| 2026-02-12 | 更新用户角色为三级：manager/leader/member |
| 2026-02-12 | 新增团队架构说明（wj/jy/yz三个小组） |
| 2026-02-12 | 新增 teams 表 |
| 2026-02-12 | 初始版本创建 |


