# 导出功能使用说明

## 一、功能概述

导出功能允许用户将分析结果导出为Excel格式（.xlsx），导出文件使用表6的模板格式，并存储在 `excel/` 目录中。

## 二、导出场景

### 2.1 员工导出
- 导出自己的分析结果
- 可以按联盟账号、平台、日期范围筛选
- 导出文件命名：`{用户名}_分析结果_{日期范围}_{时间戳}.xlsx`

### 2.2 经理导出
- 导出所有员工的分析结果
- 可以按员工、联盟账号、平台、日期范围筛选
- 导出文件命名：`工作室_分析结果_{日期范围}_{筛选条件}_{时间戳}.xlsx`

## 三、导出格式

### 3.1 文件格式
- **格式**: Excel (.xlsx)
- **模板**: 使用表6的格式作为模板
- **存储路径**: `excel/` 目录

### 3.2 文件内容
导出文件包含以下信息：
- 日期
- 员工信息（经理导出时）
- 联盟平台
- 联盟账号
- 点击（从表1提取）
- 订单数（从表2提取）
- CPC
- 保守佣金
- 保守EPC（计算得出）
- 保守ROI（计算得出）
- 其他分析结果字段

### 3.3 文件样式
- 表头：蓝色背景，白色加粗字体，居中对齐
- 数据行：带边框，数字格式化为千分位
- 列宽：自动调整或固定宽度

## 四、使用方法

### 4.1 快速导出
1. 在分析结果页面或数据总览页面
2. 点击"快速导出"按钮
3. 使用当前页面的筛选条件导出
4. 文件自动下载

### 4.2 自定义导出
1. 点击"自定义导出"按钮
2. 在弹出的对话框中设置：
   - 日期范围（可选）
   - 联盟平台（可选）
   - 联盟账号（可选）
   - 员工（仅经理可见，可选）
3. 点击"导出"按钮
4. 文件自动下载

## 五、API接口

### 5.1 导出分析结果
```
GET /api/export/analysis
```

**参数：**
- `account_id` (可选): 联盟账号ID
- `platform_id` (可选): 平台ID
- `start_date` (可选): 开始日期，格式：YYYY-MM-DD
- `end_date` (可选): 结束日期，格式：YYYY-MM-DD

**权限：**
- 员工：只能导出自己的数据
- 经理：可以导出所有员工的数据

**返回：**
- Excel文件下载

### 5.2 导出数据总览（经理专用）
```
GET /api/export/dashboard
```

**参数：**
- `employee_id` (可选): 员工ID
- `platform_id` (可选): 平台ID
- `account_id` (可选): 联盟账号ID
- `start_date` (可选): 开始日期
- `end_date` (可选): 结束日期
- `group_by` (可选): 分组方式

**权限：**
- 只有经理可以访问

**返回：**
- Excel文件下载

## 六、技术实现

### 6.1 后端实现
- 使用 `pandas` 和 `openpyxl` 生成Excel文件
- 如果表6模板存在，使用模板格式
- 如果模板不存在，使用默认格式
- 文件存储在 `excel/` 目录

### 6.2 前端实现
- 使用 `axios` 发起导出请求
- 设置 `responseType: 'blob'` 接收文件
- 创建临时下载链接自动下载文件
- 从响应头获取文件名

### 6.3 文件管理
- 导出文件存储在 `excel/` 目录
- 文件名包含时间戳，避免冲突
- 可以保留历史导出文件
- 建议定期清理旧文件（可选）

## 七、注意事项

1. **文件大小**: 大数据量导出可能需要较长时间，请耐心等待
2. **权限控制**: 员工只能导出自己的数据，经理可以导出所有数据
3. **筛选条件**: 如果筛选后没有数据，导出会失败并提示
4. **文件格式**: 确保表6模板文件存在，否则使用默认格式
5. **存储空间**: 注意 `excel/` 目录的存储空间，定期清理旧文件

## 八、故障排除

### 8.1 导出失败
- 检查是否有可导出的数据
- 检查筛选条件是否正确
- 检查文件权限（写入excel目录的权限）

### 8.2 文件格式不正确
- 检查表6模板文件是否存在
- 检查模板文件格式是否正确
- 如果模板有问题，系统会使用默认格式

### 8.3 下载失败
- 检查浏览器下载设置
- 检查网络连接
- 尝试使用其他浏览器

## 九、未来改进

1. **异步导出**: 大数据量时使用异步任务，导出完成后通知用户
2. **导出历史**: 记录导出历史，可以重新下载
3. **批量导出**: 支持一次导出多个账号或平台的数据
4. **自定义字段**: 允许用户选择要导出的字段
5. **导出模板**: 允许用户自定义导出模板
















