# 快速修复同步问题 - 简单步骤

## 问题：MCC同步显示"成功同步0条数据"

这说明同步过程执行了，但没有获取到数据。我们需要检查具体原因。

## 解决步骤（在阿里云服务器上执行）

### 步骤1：更新代码

```bash
cd ~/Google-Data-Analysis
git pull
cd backend
source venv/bin/activate
```

### 步骤2：运行诊断脚本

```bash
python scripts/diagnose_sync_issues.py
```

**查看输出结果：**
- 如果显示"✗ Developer Token: 未配置" → 需要配置Developer Token
- 如果显示"✗ Client ID/Secret/Token: 未配置" → 需要在网页上编辑MCC账号填写
- 如果显示"✗ google-ads 库未安装" → 需要安装库

### 步骤3：测试MCC同步（查看详细错误）

```bash
python scripts/test_mcc_sync.py 1
```

（1是你的MCC账号ID，如果不知道ID，先运行上面的诊断脚本查看）

**这个脚本会显示：**
- 配置是否完整
- 同步过程中的详细错误信息
- 具体是哪个步骤失败了

### 步骤4：根据错误信息修复

#### 如果显示"系统缺少Google Ads开发者令牌"

1. 编辑`.env`文件：
```bash
nano .env
```

2. 添加这一行（替换成你的实际token）：
```
GOOGLE_ADS_SHARED_DEVELOPER_TOKEN=你的开发者令牌
```

3. 保存：按`Ctrl+X`，然后按`Y`，然后按`Enter`

4. 重启后端：
```bash
pkill -f "uvicorn" || true
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 &
```

#### 如果显示"Google Ads API库未安装"

```bash
pip install google-ads
```

#### 如果显示"Google Ads API错误"

这可能是：
- Token过期了 → 需要重新获取Refresh Token
- 权限不足 → 检查Google Cloud Console中的API权限
- MCC下没有客户账号 → 这是正常的，如果MCC下确实没有账号

#### 如果显示"MCC下没有找到客户账号"

这是正常的，如果：
- MCC账号下确实没有客户账号
- 或者客户账号没有广告数据

可以尝试同步更早的日期，或者检查MCC账号下是否有客户账号。

### 步骤5：再次测试

```bash
python scripts/test_mcc_sync.py 1
```

如果显示"成功同步 X 条广告系列数据"（X > 0），说明修复成功！

## 如果还是不行

请把以下信息发给我：

1. 诊断脚本的输出：
```bash
python scripts/diagnose_sync_issues.py
```

2. 测试同步的输出：
```bash
python scripts/test_mcc_sync.py 1
```

3. 后端日志的最后50行：
```bash
tail -n 50 ~/Google-Data-Analysis/backend/run.log
```

我会根据这些信息帮你进一步排查。

