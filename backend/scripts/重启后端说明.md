# 后端重启脚本使用说明

## 可用的重启脚本

### 1. Python脚本（推荐 - 跨平台）
**文件**: `restart_backend.py`
**使用方法**:
```bash
cd backend
python scripts/restart_backend.py
```

**优点**:
- 跨平台（Windows/Linux/Mac）
- 功能完整
- 自动检测和停止现有进程
- 自动检查服务器状态

### 2. PowerShell脚本（Windows）
**文件**: `restart_backend.ps1`
**使用方法**:
```powershell
cd backend
.\scripts\restart_backend.ps1
```

**注意**: 如果遇到执行策略限制，运行：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 3. 批处理脚本（Windows）
**文件**: `restart_backend.bat`
**使用方法**:
```cmd
cd backend
scripts\restart_backend.bat
```

### 4. 简单批处理脚本（Windows - 快速重启）
**文件**: `restart_backend_simple.bat`
**使用方法**:
```cmd
cd backend
scripts\restart_backend_simple.bat
```

## 手动重启方法

### Windows
```cmd
cd backend

REM 停止现有服务器（查找占用8000端口的进程）
netstat -ano | findstr :8000
taskkill /F /PID <进程ID>

REM 启动服务器
venv\Scripts\activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### Linux/Mac
```bash
cd backend

# 停止现有服务器
pkill -f "uvicorn.*app.main"

# 启动服务器
source venv/bin/activate
nohup python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 &
```

## 检查服务器状态

### 方法1: 使用健康检查端点
```bash
curl http://127.0.0.1:8000/health
```

### 方法2: 查看日志
```bash
# Windows
type backend\run.log

# Linux/Mac
tail -f backend/run.log
```

### 方法3: 访问API文档
打开浏览器访问: http://127.0.0.1:8000/docs

## 常见问题

### 1. 端口被占用
如果8000端口被占用，脚本会自动尝试停止占用该端口的进程。如果失败，可以手动：
```cmd
# Windows
netstat -ano | findstr :8000
taskkill /F /PID <进程ID>

# Linux/Mac
lsof -ti:8000 | xargs kill -9
```

### 2. 虚拟环境不存在
如果提示虚拟环境不存在，需要先创建：
```bash
cd backend
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate

pip install -r requirements.txt
```

### 3. 权限问题
- Windows: 可能需要以管理员身份运行
- Linux/Mac: 可能需要sudo权限

## 开发模式（自动重载）

如果需要开发模式（代码修改后自动重载）：
```bash
cd backend
venv\Scripts\activate  # Windows
# 或 source venv/bin/activate  # Linux/Mac

python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

