# MCC同步优化说明

## 优化内容

### 1. 增量同步检查 ✅
- **功能**：在调用Google Ads API之前，先检查数据是否已存在
- **逻辑**：
  - 如果数据已存在且是今天同步的，跳过API调用
  - 如果数据不存在或不是最新的，才调用API同步
- **好处**：避免重复同步，节省API配额

### 2. 严格限流策略 ✅
- **配额检测**：遇到配额限制（429错误）立即停止后续同步
- **不再重试**：检测到配额限制后，不再尝试后续日期
- **明确提示**：日志中明确提示配额限制，并显示需要等待的时间

### 3. 请求延迟 ✅
- **延迟时间**：每个日期同步之间延迟0.5秒
- **好处**：避免请求过快导致配额限制

### 4. 默认只同步昨天 ✅
- **逻辑**：如果不指定日期，默认同步昨天（因为今天的数据可能不完整）
- **手动同步**：可以手动指定日期范围进行同步

## 使用方式

### 自动同步（默认同步昨天）
前端点击"同步数据"按钮，不指定日期，系统会自动同步昨天的数据。

### 手动同步指定日期
前端可以指定日期范围，系统会同步指定范围内的数据。

## 配额限制处理

### 检测机制
- 检测到配额限制（429错误）时，立即停止后续同步
- 记录详细的配额限制信息，包括需要等待的时间

### 日志提示
- 配额限制时，日志会明确提示："Google Ads API配额已用完，请等待配额恢复（通常需要等待几小时到24小时）"

## 性能优化

1. **增量同步**：避免重复同步已存在的数据
2. **请求延迟**：避免请求过快
3. **配额检测**：遇到配额限制立即停止，避免浪费配额

## 注意事项

1. **配额限制**：如果遇到配额限制，需要等待几小时到24小时才能恢复
2. **数据更新**：如果数据已存在且是最新的，会跳过同步
3. **强制刷新**：如果需要强制刷新数据，可以设置`force_refresh=True`（当前未在前端暴露）

## 后续优化建议

1. **申请更高配额**：联系Google Ads支持申请更高的API配额
2. **分批同步**：将大量MCC账号分批同步，避免一次性同步太多
3. **定时任务优化**：优化定时任务的执行时间，避免高峰期同步



## 优化内容

### 1. 增量同步检查 ✅
- **功能**：在调用Google Ads API之前，先检查数据是否已存在
- **逻辑**：
  - 如果数据已存在且是今天同步的，跳过API调用
  - 如果数据不存在或不是最新的，才调用API同步
- **好处**：避免重复同步，节省API配额

### 2. 严格限流策略 ✅
- **配额检测**：遇到配额限制（429错误）立即停止后续同步
- **不再重试**：检测到配额限制后，不再尝试后续日期
- **明确提示**：日志中明确提示配额限制，并显示需要等待的时间

### 3. 请求延迟 ✅
- **延迟时间**：每个日期同步之间延迟0.5秒
- **好处**：避免请求过快导致配额限制

### 4. 默认只同步昨天 ✅
- **逻辑**：如果不指定日期，默认同步昨天（因为今天的数据可能不完整）
- **手动同步**：可以手动指定日期范围进行同步

## 使用方式

### 自动同步（默认同步昨天）
前端点击"同步数据"按钮，不指定日期，系统会自动同步昨天的数据。

### 手动同步指定日期
前端可以指定日期范围，系统会同步指定范围内的数据。

## 配额限制处理

### 检测机制
- 检测到配额限制（429错误）时，立即停止后续同步
- 记录详细的配额限制信息，包括需要等待的时间

### 日志提示
- 配额限制时，日志会明确提示："Google Ads API配额已用完，请等待配额恢复（通常需要等待几小时到24小时）"

## 性能优化

1. **增量同步**：避免重复同步已存在的数据
2. **请求延迟**：避免请求过快
3. **配额检测**：遇到配额限制立即停止，避免浪费配额

## 注意事项

1. **配额限制**：如果遇到配额限制，需要等待几小时到24小时才能恢复
2. **数据更新**：如果数据已存在且是最新的，会跳过同步
3. **强制刷新**：如果需要强制刷新数据，可以设置`force_refresh=True`（当前未在前端暴露）

## 后续优化建议

1. **申请更高配额**：联系Google Ads支持申请更高的API配额
2. **分批同步**：将大量MCC账号分批同步，避免一次性同步太多
3. **定时任务优化**：优化定时任务的执行时间，避免高峰期同步

















