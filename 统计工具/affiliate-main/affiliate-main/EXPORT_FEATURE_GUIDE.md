# 📥 商家汇总导出功能使用指南

## ✨ 功能介绍

普通用户现在可以将**商家汇总数据**导出为精美的 Excel 文件，包含完整的营销指标和统计摘要！

---

## 🚀 如何使用

### 1. **重启服务器**
由于添加了新的依赖 `exceljs`，需要先安装并重启服务器：

```bash
# 停止当前服务器（Ctrl+C）

# 安装新依赖
npm install

# 重启服务器
npm start
```

### 2. **使用导出功能**

#### 步骤 1：采集数据
1. 登录普通用户账号
2. 选择日期范围和平台账号
3. 点击「开始采集」
4. 等待采集完成，页面会显示「商家汇总」表格

#### 步骤 2：导出Excel
1. 在「💼 商家汇总」标题右侧，会看到「📥 导出Excel」按钮
2. 点击按钮
3. 按钮会显示「⏳ 生成中...」
4. 2-3秒后，Excel文件会自动下载
5. 看到「✅ Excel文件已成功导出！」提示

---

## 📊 Excel 文件内容

### 📋 文件结构

```
┌────────────────────────────────────────────────────┐
│  📊 商家汇总数据统计报表                           │
│  统计周期：2025-01-01 至 2025-01-31                │
│  总预算：$1000 | 总广告费：$500 | 总佣金：$750     │
├────────────────────────────────────────────────────┤
│ 排名 │ 广告系列 │ 商家ID │ ... │ ROI              │
├──────┼──────────┼────────┼─────┼──────────────────┤
│  1   │ Campaign1│  123   │ ... │ 2.50  🟢         │
│  2   │ Campaign2│  456   │ ... │ 0.80  🟢         │
│  3   │ Campaign3│  789   │ ... │ -0.20 🔴         │
└────────────────────────────────────────────────────┘
```

### ✨ 特色功能

- **顶部统计摘要** - 总预算、总广告费、总佣金、整体ROI、商家数、总订单
- **完整营销指标** - 包含 CR、EPC、CPC、ROI 等13个指标
- **精美样式**
  - 表头：深蓝色背景 + 白色文字
  - 数据行：斑马纹（白色/浅灰色交替）
  - ROI：正数绿色，负数红色
  - 统计摘要：淡蓝色背景
- **数字格式化**
  - 金额：$1,234.56
  - 百分比：12.34%
  - 数字：自动千位分隔符
- **自动列宽** - 根据内容调整，阅读更舒适
- **完整边框** - 所有单元格都有边框

### 📝 包含的列

1. **排名** - 按ROI排序
2. **广告系列** - 广告系列名称
3. **商家ID** - 商家标识
4. **预算** - 总预算（美元）
5. **展示** - 广告展示次数
6. **点击** - 广告点击次数
7. **广告费** - 总广告费（美元）
8. **订单数** - 订单数量
9. **总佣金** - 总佣金收入（美元）
10. **CR** - 转化率（订单数/点击数）
11. **EPC** - 每点击收益（佣金/点击数）
12. **CPC** - 每点击成本（广告费/点击数）
13. **ROI** - 投资回报率

---

## 📁 文件命名规则

文件名格式：`商家汇总_用户名_日期范围.xlsx`

示例：
- `商家汇总_张三_2025-01-01至2025-01-31.xlsx`
- `商家汇总_test_全部数据.xlsx`

---

## 🎯 功能特点

### ✅ 优势

1. **不影响现有功能** - 完全新增功能，原有采集和显示不受影响
2. **自动筛选** - 导出的数据与当前显示的完全一致（日期、账号）
3. **专业格式** - Excel格式美观，可直接用于汇报
4. **快速生成** - 2-3秒即可生成并下载
5. **数据完整** - 包含所有营销指标和统计摘要
6. **用户体验好**
   - 加载状态提示
   - 成功/失败提示
   - 按钮禁用防止重复点击

### 🔒 安全性

- ✅ 需要登录才能使用
- ✅ 只能导出自己的数据
- ✅ 使用 JWT Token 验证身份
- ✅ 后端强制检查用户权限

---

## 🐛 故障排查

### 问题 1：没有看到导出按钮
**原因**：按钮只在商家汇总显示后才会出现  
**解决**：先采集数据，当商家汇总表格显示后，按钮就会出现

### 问题 2：点击导出没反应
**原因**：可能是 exceljs 依赖没安装  
**解决**：
```bash
npm install exceljs
npm start
```

### 问题 3：导出提示"暂无数据可导出"
**原因**：当前筛选条件下没有符合的商家数据  
**解决**：
1. 调整日期范围
2. 确保选中的账号有数据
3. 重新采集数据

### 问题 4：Excel打不开或乱码
**原因**：文件损坏或下载不完整  
**解决**：
1. 重新导出
2. 确保网络稳定
3. 使用最新版本的 Excel 或 WPS

---

## 📈 后续扩展

如果需要，可以轻松添加：
- ✅ 订单明细导出
- ✅ 广告数据导出
- ✅ 超管全局数据导出
- ✅ CSV 格式导出
- ✅ PDF 报表导出

---

## 💡 技术实现

- **后端**: Node.js + ExcelJS
- **前端**: 原生 JavaScript + Fetch API
- **文件格式**: .xlsx (Excel 2007+)
- **API路由**: `POST /api/export/merchant-summary`

---

## 📞 支持

如有问题或建议，请联系开发团队！

---

**版本**: v1.0  
**更新日期**: 2025-10-31  
**状态**: ✅ 已完成并测试


