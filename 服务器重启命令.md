# 服务器重启命令（解决端口占用问题）

## 问题
端口8000被占用，需要彻底杀死旧进程后重启

## 解决步骤

### 1. 检查并杀死所有uvicorn进程
```bash
# 查找所有uvicorn进程
ps aux | grep uvicorn | grep -v grep

# 强制杀死所有uvicorn进程
pkill -9 -f "uvicorn app.main:app"

# 等待2秒确保进程完全退出
sleep 2

# 再次检查，确保没有进程在运行
ps aux | grep uvicorn | grep -v grep
```

### 2. 检查端口占用
```bash
# 检查8000端口是否被占用
lsof -i:8000 || netstat -tulpn | grep 8000

# 如果有进程占用，杀死它
kill -9 $(lsof -t -i:8000) 2>/dev/null || true
```

### 3. 清理缓存并重启
```bash
cd ~/Google-Data-Analysis/backend
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
find . -name "*.pyc" -delete 2>/dev/null || true
source venv/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 &
sleep 5
curl -s http://127.0.0.1:8000/health && echo "✓ 后端重启成功" || tail -n 50 run.log
```

## 一键执行命令（推荐）

```bash
cd ~/Google-Data-Analysis/backend && \
pkill -9 -f "uvicorn app.main:app" && \
sleep 3 && \
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true && \
find . -name "*.pyc" -delete 2>/dev/null || true && \
source venv/bin/activate && \
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 & \
sleep 5 && \
curl -s http://127.0.0.1:8000/health && echo "✓ 后端重启成功" || tail -n 50 run.log
```

## 验证服务状态

```bash
# 检查进程
ps aux | grep uvicorn | grep -v grep

# 检查健康状态
curl -s http://127.0.0.1:8000/health

# 查看日志
tail -n 50 ~/Google-Data-Analysis/backend/run.log
```

