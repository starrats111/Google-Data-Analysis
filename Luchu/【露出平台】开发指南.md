# ğŸ› ï¸ éœ²å‡ºå¹³å° å¼€å‘æŒ‡å—

> **ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-13  
> **é€‚ç”¨å¯¹è±¡**: å¼€å‘äººå‘˜  
> **é¡¹ç›®ä»£å·**: Luchu Platform

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#ä¸€é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#äºŒæŠ€æœ¯æ¶æ„)
3. [ç¯å¢ƒæ­å»º](#ä¸‰ç¯å¢ƒæ­å»º)
4. [é¡¹ç›®ç»“æ„](#å››é¡¹ç›®ç»“æ„)
5. [æ ¸å¿ƒæ¨¡å—å¼€å‘](#äº”æ ¸å¿ƒæ¨¡å—å¼€å‘)
6. [APIæ¥å£è§„èŒƒ](#å…­apiæ¥å£è§„èŒƒ)
7. [æ•°æ®åº“è®¾è®¡](#ä¸ƒæ•°æ®åº“è®¾è®¡)
8. [å‰ç«¯å¼€å‘](#å…«å‰ç«¯å¼€å‘)
9. [éƒ¨ç½²æµç¨‹](#ä¹éƒ¨ç½²æµç¨‹)
10. [å‚è€ƒæ–‡æ¡£](#åå‚è€ƒæ–‡æ¡£)

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

éœ²å‡ºå¹³å°æ˜¯ä¸€ä¸ª**AIé©±åŠ¨çš„åšå®¢å†…å®¹ç®¡ç†ç³»ç»Ÿ**ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç”Ÿæˆã€å®¡æ ¸å’Œå‘å¸ƒæ¨å¹¿æ€§è´¨çš„åšå®¢æ–‡ç« ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¸…å•

| æ¨¡å— | åŠŸèƒ½ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|--------|------|
| **å†…å®¹åˆ›å»º** | è¾“å…¥å•†å®¶URLï¼ŒAIè‡ªåŠ¨ç”Ÿæˆæ–‡ç«  | P0 | å¾…å¼€å‘ |
| **å›¾ç‰‡ç®¡ç†** | è‡ªåŠ¨è·å–5å¼ å›¾ç‰‡ï¼Œå¤–é“¾æ£€æµ‹ | P0 | å¾…å¼€å‘ |
| **å®¡æ ¸ç®¡ç†** | æ–‡ç« å®¡æ ¸ã€é©³å›ã€ä¿®æ”¹ | P1 | å¾…å¼€å‘ |
| **å‘å¸ƒæ¨é€** | ä¸€é”®æ¨é€åˆ°GitHub/ç½‘ç«™ | P0 | å¾…å¼€å‘ |
| **å†…å®¹ç®¡ç†** | æ–‡ç« åˆ—è¡¨ã€æœç´¢ã€ç­›é€‰ | P1 | å¾…å¼€å‘ |
| **ç½‘ç«™ç®¡ç†** | å¤šç½‘ç«™é…ç½®ç®¡ç† | P1 | å¾…å¼€å‘ |
| **ç”¨æˆ·è®¤è¯** | ç™»å½•ã€æƒé™æ§åˆ¶ | P0 | å¾…å¼€å‘ |
| **å›¾ç‰‡æ£€æµ‹** | æ¯æ—¥å¤–é“¾æœ‰æ•ˆæ€§æ£€æµ‹ | P2 | å¾…å¼€å‘ |
| **æ•°æ®ç»Ÿè®¡** | å‘å¸ƒç»Ÿè®¡ã€å·¥ä½œé‡ç»Ÿè®¡ | P2 | å¾…å¼€å‘ |

### 1.3 ç”¨æˆ·è§’è‰²

| è§’è‰² | äººå‘˜ | æƒé™ |
|------|------|------|
| ç®¡ç†å‘˜ | wj07 | å…¨éƒ¨åŠŸèƒ½ + ç³»ç»Ÿè®¾ç½® |
| å®¡æ ¸å‘˜ | wj02, wj07 | å®¡æ ¸ + ç¼–è¾‘ + å‘å¸ƒ + è‡ªæ£€æ¨¡å¼ |
| ç¼–è¾‘ | wj01,03-06,09,10 | åˆ›å»º + ç¼–è¾‘è‡ªå·±çš„å†…å®¹ |

### 1.4 ç›®æ ‡ç½‘ç«™

| ID | ç½‘ç«™ | åŸŸå | è´Ÿè´£äºº | GitHubä»“åº“ |
|----|------|------|--------|------------|
| 1 | EverydayHaven | everydayhaven.top | wj01 | starrats111/EverydayHaven |
| 2 | Quiblo | quiblo.top | wj02 | starrats111/Quiblo |
| 3 | Kivanta | kivanta.top | wj03 | starrats111/Kivanta |
| 4 | NovaNest | novanest.one | wj04 | starrats111/NovaNest |
| 5 | Zontri | zontri.top | wj05 | starrats111/Zontri |
| 6 | AlluraHub | allurahub.top | wj06 | starrats111/AlluraHub |
| 7 | VitaHaven | vitahaven.click | wj07 | starrats111/VitaHaven |
| 8 | â€” | â€” | wj08 | å·²ç¦»èŒ |
| 9 | BloomRoots | bloomroots.top | wj09 | starrats111/BloomRoots |
| 10 | VitaSphere | vitasphere.top | wj10 | starrats111/VitaSphere |

---

## äºŒã€æŠ€æœ¯æ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æµè§ˆå™¨ (wj01-wj10)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloudflare Pages (å‰ç«¯)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   React + TypeScript                       â”‚  â”‚
â”‚  â”‚  â€¢ ç™»å½•é¡µ      â€¢ ä»ªè¡¨ç›˜      â€¢ å†…å®¹åˆ›å»º                    â”‚  â”‚
â”‚  â”‚  â€¢ æ–‡ç« ç®¡ç†    â€¢ å®¡æ ¸ç®¡ç†    â€¢ å‘å¸ƒç®¡ç†                    â”‚  â”‚
â”‚  â”‚  â€¢ ç½‘ç«™ç®¡ç†    â€¢ å›¾ç‰‡æ£€æµ‹    â€¢ ç³»ç»Ÿè®¾ç½®                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTPS APIè¯·æ±‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cloudflare Workers (åç«¯API)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è®¤è¯æ¨¡å—    â”‚ â”‚ æ–‡ç« æ¨¡å—    â”‚ â”‚ AIæ¨¡å—      â”‚ â”‚ å›¾ç‰‡æ¨¡å—  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å®¡æ ¸æ¨¡å—    â”‚ â”‚ å‘å¸ƒæ¨¡å—    â”‚ â”‚ ç½‘ç«™æ¨¡å—    â”‚ â”‚ å®šæ—¶ä»»åŠ¡  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare   â”‚  â”‚   Claude     â”‚  â”‚   GitHub     â”‚
â”‚ D1 (SQLite)  â”‚  â”‚   API        â”‚  â”‚   API        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **å‰ç«¯æ¡†æ¶** | React | 18.x | UIæ¡†æ¶ |
| **ç±»å‹ç³»ç»Ÿ** | TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| **æ„å»ºå·¥å…·** | Vite | 5.x | å¼€å‘æ„å»º |
| **UIç»„ä»¶** | shadcn/ui | latest | ç»„ä»¶åº“ |
| **æ ·å¼** | Tailwind CSS | 3.x | æ ·å¼æ¡†æ¶ |
| **çŠ¶æ€ç®¡ç†** | Zustand | 4.x | è½»é‡çŠ¶æ€ç®¡ç† |
| **HTTPå®¢æˆ·ç«¯** | Axios | 1.x | APIè¯·æ±‚ |
| **åç«¯è¿è¡Œæ—¶** | Cloudflare Workers | - | Serverless |
| **è·¯ç”±** | Hono | 4.x | è½»é‡Webæ¡†æ¶ |
| **æ•°æ®åº“** | Cloudflare D1 | - | SQLite |
| **AI** | Claude API | Sonnet 3.5 | å†…å®¹ç”Ÿæˆ |
| **ç‰ˆæœ¬æ§åˆ¶** | GitHub API | v3 | ä»£ç æ¨é€ |

### 2.3 æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥å•†å®¶URL
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯è¡¨å•    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/ai/analyze
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯Worker  â”‚â”€â”€â”€â”€â”€â–¶â”‚  Claude API  â”‚
â”‚  (åˆ†æURL)   â”‚â—€â”€â”€â”€â”€â”€â”‚  (Vision)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è¿”å›å•†å®¶ä¿¡æ¯+å›¾ç‰‡
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯é¢„è§ˆ    â”‚
â”‚  ç¡®è®¤ç”Ÿæˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/ai/generate
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯Worker  â”‚â”€â”€â”€â”€â”€â–¶â”‚  Claude API  â”‚
â”‚  (ç”Ÿæˆå†…å®¹)  â”‚â—€â”€â”€â”€â”€â”€â”‚  (Sonnet)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è¿”å›æ–‡ç« å†…å®¹
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ç¼–è¾‘    â”‚
â”‚  æäº¤å®¡æ ¸    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/articles
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯Worker  â”‚â”€â”€â”€â”€â”€â–¶â”‚  D1æ•°æ®åº“    â”‚
â”‚  (ä¿å­˜æ–‡ç« )  â”‚â—€â”€â”€â”€â”€â”€â”‚  (å­˜å‚¨)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   å®¡æ ¸æµç¨‹...
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯Worker  â”‚â”€â”€â”€â”€â”€â–¶â”‚  GitHub API  â”‚
â”‚  (å‘å¸ƒæ¨é€)  â”‚â—€â”€â”€â”€â”€â”€â”‚  (æäº¤)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare  â”‚
â”‚  è‡ªåŠ¨éƒ¨ç½²    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   ç½‘ç«™æ›´æ–° âœ“
```

---

## ä¸‰ã€ç¯å¢ƒæ­å»º

### 3.1 å‰ç½®æ¡ä»¶

```bash
# Node.js 18+
node -v  # v18.x.x æˆ–æ›´é«˜

# pnpm (æ¨è) æˆ– npm
pnpm -v  # 8.x.x

# Wrangler CLI (Cloudflare)
npm install -g wrangler
wrangler -v
```

### 3.2 é¡¹ç›®åˆå§‹åŒ–

```bash
# 1. åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir luchu-platform
cd luchu-platform

# 2. åˆå§‹åŒ–å‰ç«¯é¡¹ç›®
pnpm create vite frontend --template react-ts
cd frontend
pnpm install

# 3. å®‰è£…å‰ç«¯ä¾èµ–
pnpm add axios zustand @tanstack/react-query
pnpm add -D tailwindcss postcss autoprefixer
pnpm add lucide-react class-variance-authority clsx tailwind-merge

# 4. åˆå§‹åŒ– Tailwind
npx tailwindcss init -p

# 5. è¿”å›æ ¹ç›®å½•ï¼Œåˆ›å»ºåç«¯é¡¹ç›®
cd ..
mkdir workers
cd workers
pnpm init
pnpm add hono
pnpm add -D wrangler typescript @cloudflare/workers-types
```

### 3.3 Cloudflare é…ç½®

```bash
# 1. ç™»å½• Cloudflare
wrangler login

# 2. åˆ›å»º D1 æ•°æ®åº“
wrangler d1 create luchu-db

# 3. è®°å½•æ•°æ®åº“IDï¼Œæ›´æ–° wrangler.toml
```

**wrangler.toml**:
```toml
name = "luchu-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

[[d1_databases]]
binding = "DB"
database_name = "luchu-db"
database_id = "your-database-id-here"

[vars]
CLAUDE_API_KEY = ""
GITHUB_TOKEN = ""
```

### 3.4 ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | è·å–æ–¹å¼ |
|--------|------|----------|
| `CLAUDE_API_KEY` | Claude APIå¯†é’¥ | console.anthropic.com |
| `GITHUB_TOKEN` | GitHub PAT | GitHub Settings > Developer settings |

```bash
# è®¾ç½® secrets (ç”Ÿäº§ç¯å¢ƒ)
wrangler secret put CLAUDE_API_KEY
wrangler secret put GITHUB_TOKEN
```

---

## å››ã€é¡¹ç›®ç»“æ„

### 4.1 æ•´ä½“ç›®å½•ç»“æ„

```
luchu-platform/
â”œâ”€â”€ frontend/                    # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/         # ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/            # åŸºç¡€UIç»„ä»¶ (shadcn)
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/        # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Layout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ features/      # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ ArticleForm.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ ArticleList.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ ReviewCard.tsx
â”‚   â”‚   â”‚       â””â”€â”€ ImageChecker.tsx
â”‚   â”‚   â”œâ”€â”€ pages/             # é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Create.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Articles.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ArticleEdit.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Reviews.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Publish.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Websites.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Images.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Settings.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰Hook
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useArticles.ts
â”‚   â”‚   â”‚   â””â”€â”€ useWebsites.ts
â”‚   â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts         # axioså®ä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ articles.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ai.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ images.ts
â”‚   â”‚   â”‚   â””â”€â”€ publish.ts
â”‚   â”‚   â”œâ”€â”€ stores/            # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â”‚   â””â”€â”€ uiStore.ts
â”‚   â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ article.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ website.ts
â”‚   â”‚   â”‚   â””â”€â”€ image.ts
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ date.ts
â”‚   â”‚   â”‚   â””â”€â”€ format.ts
â”‚   â”‚   â”œâ”€â”€ styles/            # æ ·å¼
â”‚   â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ workers/                     # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/            # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ articles.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ai.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ images.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ reviews.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ publish.ts
â”‚   â”‚   â”‚   â””â”€â”€ websites.ts
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ claude.ts      # Claude APIå°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ github.ts      # GitHub APIå°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ imageChecker.ts # å›¾ç‰‡æ£€æµ‹
â”‚   â”‚   â”‚   â””â”€â”€ db.ts          # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts        # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ cors.ts        # CORS
â”‚   â”‚   â”œâ”€â”€ types/             # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ index.ts           # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ schema.sql             # æ•°æ®åº“Schema
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ wrangler.toml
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ éœ²å‡ºæŒ‡å—.txt
â”‚   â”œâ”€â”€ éœ²å‡ºæç¤ºè¯.txt
â”‚   â”œâ”€â”€ ã€éœ²å‡ºå¹³å°ã€‘å¼€å‘æ–¹æ¡ˆ.md
â”‚   â”œâ”€â”€ ã€éœ²å‡ºå¹³å°ã€‘å¼€å‘æŒ‡å—.md      # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ ã€éœ²å‡ºå¹³å°ã€‘UIè®¾è®¡æŒ‡å—.md
â”‚   â””â”€â”€ ã€éœ²å‡ºå¹³å°ã€‘åè¯å®šä¹‰å‚è€ƒæ‰‹å†Œ.md
â”‚
â””â”€â”€ README.md
```

### 4.2 å‰ç«¯è·¯ç”±ç»“æ„

| è·¯å¾„ | é¡µé¢ | æƒé™ |
|------|------|------|
| `/login` | ç™»å½•é¡µ | å…¬å¼€ |
| `/` | ä»ªè¡¨ç›˜ | å·²ç™»å½• |
| `/create` | å†…å®¹åˆ›å»º | å·²ç™»å½• |
| `/articles` | æ–‡ç« åˆ—è¡¨ | å·²ç™»å½• |
| `/articles/:id/edit` | æ–‡ç« ç¼–è¾‘ | å·²ç™»å½•+ä½œè€… |
| `/reviews` | å®¡æ ¸ç®¡ç† | å®¡æ ¸å‘˜ |
| `/publish` | å‘å¸ƒç®¡ç† | å·²ç™»å½• |
| `/websites` | ç½‘ç«™ç®¡ç† | ç®¡ç†å‘˜ |
| `/images` | å›¾ç‰‡æ£€æµ‹ | å·²ç™»å½• |
| `/settings` | ç³»ç»Ÿè®¾ç½® | ç®¡ç†å‘˜ |

---

## äº”ã€æ ¸å¿ƒæ¨¡å—å¼€å‘

### 5.1 æ¨¡å—ä¸€ï¼šç”¨æˆ·è®¤è¯

#### 5.1.1 åŠŸèƒ½è¯´æ˜

- ç”¨æˆ·ç™»å½•/ç™»å‡º
- Sessionç®¡ç†
- æƒé™éªŒè¯

#### 5.1.2 å®ç°è¦ç‚¹

**åç«¯ - `workers/src/routes/auth.ts`**:

```typescript
import { Hono } from 'hono';
import { sign, verify } from 'hono/jwt';

const auth = new Hono();

// ç”¨æˆ·åˆ—è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…å¯ä»æ•°æ®åº“è¯»å–ï¼‰
const USERS = {
  wj01: { id: 1, name: 'wj01', role: 'editor', website_id: 1 },
  wj02: { id: 2, name: 'wj02', role: 'reviewer', website_id: 2 },
  wj07: { id: 7, name: 'wj07', role: 'admin', website_id: 7 },
  // ... å…¶ä»–ç”¨æˆ·
};

// ç™»å½•
auth.post('/login', async (c) => {
  const { username, password } = await c.req.json();
  
  const user = USERS[username];
  if (!user) {
    return c.json({ error: 'ç”¨æˆ·ä¸å­˜åœ¨' }, 401);
  }
  
  // ç®€åŒ–ï¼šå¯†ç éªŒè¯é€»è¾‘
  // å®é™…åº”ä½¿ç”¨bcryptç­‰åŠ å¯†éªŒè¯
  
  const token = await sign({
    id: user.id,
    name: user.name,
    role: user.role,
    exp: Math.floor(Date.now() / 1000) + 60 * 60 * 24 * 7, // 7å¤©
  }, c.env.JWT_SECRET);
  
  return c.json({ token, user });
});

// è·å–å½“å‰ç”¨æˆ·
auth.get('/me', async (c) => {
  const user = c.get('user'); // ä»ä¸­é—´ä»¶è·å–
  return c.json({ user });
});

export default auth;
```

**å‰ç«¯ - `frontend/src/stores/authStore.ts`**:

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface User {
  id: number;
  name: string;
  role: 'admin' | 'reviewer' | 'editor';
  website_id: number;
}

interface AuthState {
  token: string | null;
  user: User | null;
  login: (token: string, user: User) => void;
  logout: () => void;
  isAdmin: () => boolean;
  isReviewer: () => boolean;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      token: null,
      user: null,
      login: (token, user) => set({ token, user }),
      logout: () => set({ token: null, user: null }),
      isAdmin: () => get().user?.role === 'admin',
      isReviewer: () => ['admin', 'reviewer'].includes(get().user?.role || ''),
    }),
    { name: 'auth-storage' }
  )
);
```

#### 5.1.3 å‚è€ƒæ–‡æ¡£

- ã€éœ²å‡ºå¹³å°ã€‘åè¯å®šä¹‰å‚è€ƒæ‰‹å†Œ.md - ä¸ƒã€è§’è‰²ä¸æƒé™æœ¯è¯­

---

### 5.2 æ¨¡å—äºŒï¼šAIå†…å®¹ç”Ÿæˆï¼ˆClaude Tool Useï¼‰

#### 5.2.1 åŠŸèƒ½è¯´æ˜

1. **è‡ªåŠ¨çˆ¬å–**ï¼šä½¿ç”¨ Claude Tool Use è°ƒç”¨åç«¯ fetch è·å–ç½‘é¡µå†…å®¹
2. **æ™ºèƒ½åˆ†æ**ï¼šClaude åˆ†æç½‘é¡µ HTMLï¼Œæå–å•†å®¶ä¿¡æ¯å’Œå›¾ç‰‡
3. **å†…å®¹ç”Ÿæˆ**ï¼šæ ¹æ®æç¤ºè¯æ¨¡æ¿ç”Ÿæˆæ–‡ç« å†…å®¹
4. è¿”å›ç»“æ„åŒ–çš„æ–‡ç« æ•°æ®

#### 5.2.2 æ ¸å¿ƒåŸç†

Claude API æœ¬èº«æ— æ³•ç›´æ¥è®¿é—® URLï¼Œä½†é€šè¿‡ **Tool Useï¼ˆå·¥å…·è°ƒç”¨ï¼‰** åŠŸèƒ½ï¼Œå¯ä»¥è®© Claude è¯·æ±‚è°ƒç”¨åç«¯å®šä¹‰çš„å·¥å…·ï¼Œç”±åç«¯å®é™…æ‰§è¡Œç½‘é¡µçˆ¬å–ï¼Œå†å°†ç»“æœè¿”å›ç»™ Claude åˆ†æã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Tool Use æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. ç”¨æˆ·è¾“å…¥å•†å®¶URL                                             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  2. Worker è°ƒç”¨ Claude API (æºå¸¦ tools å®šä¹‰)                    â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  3. Claude è¿”å› tool_use è¯·æ±‚: "è¯·è°ƒç”¨ fetch_webpage(url)"      â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  4. Worker å®é™…æ‰§è¡Œ fetch(url) è·å–ç½‘é¡µ HTML                    â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  5. Worker å°† HTML ä½œä¸º tool_result è¿”å›ç»™ Claude               â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  6. Claude åˆ†æ HTMLï¼Œæå–å“ç‰Œä¿¡æ¯ã€å›¾ç‰‡URL                     â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  7. Claude è¿”å›ç»“æ„åŒ–çš„å•†å®¶æ•°æ®                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.2.3 å®ç°è¦ç‚¹

**åç«¯ - `workers/src/services/claude.ts`**:

```typescript
import Anthropic from '@anthropic-ai/sdk';

// å·¥å…·å®šä¹‰
const tools: Anthropic.Tool[] = [
  {
    name: "fetch_webpage",
    description: "è·å–æŒ‡å®šURLçš„ç½‘é¡µHTMLå†…å®¹ï¼Œç”¨äºåˆ†æå•†å®¶ç½‘ç«™",
    input_schema: {
      type: "object" as const,
      properties: {
        url: {
          type: "string",
          description: "è¦è·å–çš„ç½‘é¡µURL"
        }
      },
      required: ["url"]
    }
  },
  {
    name: "fetch_image_info",
    description: "è·å–å›¾ç‰‡çš„å…ƒä¿¡æ¯ï¼ˆæ£€æµ‹æ˜¯å¦å¯è®¿é—®ï¼‰",
    input_schema: {
      type: "object" as const,
      properties: {
        url: {
          type: "string",
          description: "å›¾ç‰‡URL"
        }
      },
      required: ["url"]
    }
  }
];

export class ClaudeService {
  private client: Anthropic;
  
  constructor(apiKey: string) {
    this.client = new Anthropic({ apiKey });
  }
  
  // åˆ†æå•†å®¶URLï¼ˆä½¿ç”¨ Tool Useï¼‰
  async analyzeUrl(url: string): Promise<MerchantData> {
    let messages: Anthropic.MessageParam[] = [{
      role: 'user',
      content: `è¯·åˆ†æä»¥ä¸‹å•†å®¶ç½‘ç«™ï¼Œæå–ï¼š
1. å“ç‰Œåç§°
2. å“ç‰Œæè¿°ï¼ˆç®€çŸ­ï¼Œ2-3å¥è¯ï¼‰
3. ä¸»è¥äº§å“ç±»å‹
4. å½“å‰ä¿ƒé”€æ´»åŠ¨æˆ–çƒ­é—¨äº§å“ï¼ˆå¦‚æœ‰ï¼‰
5. ä»ç½‘é¡µä¸­é€‰å–5å¼ æœ€é€‚åˆåšåšå®¢é…å›¾çš„é«˜è´¨é‡å›¾ç‰‡URL
   - 1å¼ ä¸»å›¾ï¼ˆheroï¼‰+ 4å¼ å†…å®¹å›¾
   - ä¼˜å…ˆé€‰æ‹©äº§å“å›¾ã€åœºæ™¯å›¾
   - è¿‡æ»¤æ‰logoã€å°å›¾æ ‡ï¼ˆ<200pxï¼‰ã€bannerå¹¿å‘Š
   - å›¾ç‰‡å°ºå¯¸åº”å¤§äº400x400
6. ä¸ºæ¯å¼ å›¾ç‰‡ç”Ÿæˆç®€çŸ­çš„altæè¿°ï¼ˆç”¨äºSEOï¼‰

å•†å®¶ç½‘å€: ${url}

è¯·ä»¥JSONæ ¼å¼è¿”å›ç»“æœï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
{
  "brandName": "å“ç‰Œåç§°",
  "brandDescription": "å“ç‰Œæè¿°",
  "productType": "ä¸»è¥äº§å“",
  "products": [{"name": "äº§å“å", "price": "ä»·æ ¼", "description": "æè¿°"}],
  "images": [
    {"url": "å›¾ç‰‡URL", "type": "hero", "alt": "å›¾ç‰‡æè¿°"},
    {"url": "å›¾ç‰‡URL", "type": "content", "alt": "å›¾ç‰‡æè¿°"},
    ...
  ],
  "categorySuggestion": "å»ºè®®åˆ†ç±»(fashion/health/home/travel/finance/food)"
}`
    }];
    
    let response = await this.client.messages.create({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 4096,
      tools: tools,
      messages: messages
    });
    
    // Tool Use å¾ªç¯ï¼šå¤„ç†å·¥å…·è°ƒç”¨è¯·æ±‚
    while (response.stop_reason === 'tool_use') {
      const toolUseBlocks = response.content.filter(
        (c): c is Anthropic.ToolUseBlock => c.type === 'tool_use'
      );
      
      const toolResults: Anthropic.ToolResultBlockParam[] = [];
      
      for (const toolUse of toolUseBlocks) {
        let result: string;
        
        if (toolUse.name === 'fetch_webpage') {
          result = await this.fetchWebpage((toolUse.input as any).url);
        } else if (toolUse.name === 'fetch_image_info') {
          const info = await this.fetchImageInfo((toolUse.input as any).url);
          result = JSON.stringify(info);
        } else {
          result = 'Unknown tool';
        }
        
        toolResults.push({
          type: 'tool_result',
          tool_use_id: toolUse.id,
          content: result
        });
      }
      
      // ç»§ç»­å¯¹è¯ï¼Œä¼ å…¥å·¥å…·æ‰§è¡Œç»“æœ
      messages = [
        ...messages,
        { role: 'assistant', content: response.content },
        { role: 'user', content: toolResults }
      ];
      
      response = await this.client.messages.create({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 4096,
        tools: tools,
        messages: messages
      });
    }
    
    // è§£ææœ€ç»ˆç»“æœ
    const textContent = response.content.find(
      (c): c is Anthropic.TextBlock => c.type === 'text'
    );
    
    if (textContent) {
      return this.parseJsonResult(textContent.text);
    }
    
    throw new Error('åˆ†æå¤±è´¥ï¼šæœªè·å–åˆ°æœ‰æ•ˆå“åº”');
  }
  
  // å®é™…æ‰§è¡Œç½‘é¡µçˆ¬å–
  private async fetchWebpage(url: string): Promise<string> {
    try {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 15000); // 15ç§’è¶…æ—¶
      
      const response = await fetch(url, {
        headers: {
          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
          'Accept-Language': 'en-US,en;q=0.5'
        },
        signal: controller.signal
      });
      
      clearTimeout(timeout);
      
      if (!response.ok) {
        return `Error: HTTP ${response.status} - ${response.statusText}`;
      }
      
      let html = await response.text();
      
      // æ¸…ç†HTMLï¼Œå‡å°‘tokenæ¶ˆè€—
      html = this.cleanHtml(html);
      
      // é™åˆ¶é•¿åº¦ï¼ˆçº¦50Kå­—ç¬¦ï¼Œé¿å…tokenè¶…é™ï¼‰
      if (html.length > 50000) {
        html = html.substring(0, 50000) + '\n<!-- [å†…å®¹å·²æˆªæ–­] -->';
      }
      
      return html;
    } catch (error: any) {
      if (error.name === 'AbortError') {
        return 'Error: è¯·æ±‚è¶…æ—¶ï¼ˆ15ç§’ï¼‰';
      }
      return `Error: ${error.message}`;
    }
  }
  
  // æ¸…ç†HTMLï¼Œç§»é™¤æ— ç”¨å†…å®¹
  private cleanHtml(html: string): string {
    // ç§»é™¤scriptæ ‡ç­¾
    html = html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
    // ç§»é™¤styleæ ‡ç­¾
    html = html.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '');
    // ç§»é™¤HTMLæ³¨é‡Š
    html = html.replace(/<!--[\s\S]*?-->/g, '');
    // å‹ç¼©ç©ºç™½
    html = html.replace(/\s+/g, ' ');
    
    return html;
  }
  
  // è·å–å›¾ç‰‡ä¿¡æ¯
  private async fetchImageInfo(url: string): Promise<{url: string; status: string; contentType?: string}> {
    try {
      const response = await fetch(url, { method: 'HEAD' });
      
      return {
        url: url,
        status: response.ok ? 'valid' : 'invalid',
        contentType: response.headers.get('content-type') || undefined
      };
    } catch (error: any) {
      return {
        url: url,
        status: 'error'
      };
    }
  }
  
  // ç”Ÿæˆæ–‡ç« å†…å®¹
  async generateArticle(params: GenerateParams): Promise<ArticleData> {
    const { merchantData, trackingLink, keywordCount, promptTemplate } = params;
    
    // ä½¿ç”¨æç¤ºè¯æ¨¡æ¿ï¼Œæ›¿æ¢å˜é‡
    const prompt = this.buildPrompt(merchantData, trackingLink, keywordCount, promptTemplate);
    
    const response = await this.client.messages.create({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 8192,
      messages: [{
        role: 'user',
        content: prompt
      }]
    });
    
    const textContent = response.content.find(
      (c): c is Anthropic.TextBlock => c.type === 'text'
    );
    
    if (textContent) {
      return this.parseJsonResult(textContent.text);
    }
    
    throw new Error('ç”Ÿæˆå¤±è´¥');
  }
  
  private buildPrompt(
    merchantData: MerchantData, 
    trackingLink: string, 
    keywordCount: number,
    promptTemplate: string
  ): string {
    // å¦‚æœæœ‰è‡ªå®šä¹‰æ¨¡æ¿ï¼Œä½¿ç”¨æ¨¡æ¿
    if (promptTemplate) {
      return promptTemplate
        .replace(/\[å•†å®¶URL\]/g, merchantData.url || '')
        .replace(/\[å“ç‰Œåç§°\]/g, merchantData.brandName)
        .replace(/\[è¿½è¸ªé“¾æ¥\]/g, trackingLink)
        .replace(/\[å…³é”®è¯æ¬¡æ•°\]/g, keywordCount.toString())
        .replace(/\[å•†å®¶ä¿¡æ¯\]/g, JSON.stringify(merchantData, null, 2))
        .replace(/\[å›¾ç‰‡åˆ—è¡¨\]/g, JSON.stringify(merchantData.images, null, 2));
    }
    
    // é»˜è®¤æç¤ºè¯
    return `
ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ç”Ÿæ´»æ–¹å¼å†…å®¹ç¼–è¾‘ã€‚è¯·æ ¹æ®ä»¥ä¸‹å•†å®¶ä¿¡æ¯ï¼Œæ’°å†™ä¸€ç¯‡é«˜è´¨é‡çš„è½¯æ–‡æ¨å¹¿åšå®¢æ–‡ç« ã€‚

## å•†å®¶ä¿¡æ¯
å“ç‰Œåç§°: ${merchantData.brandName}
å“ç‰Œæè¿°: ${merchantData.brandDescription}
äº§å“ç±»å‹: ${merchantData.productType}
äº§å“åˆ—è¡¨: ${JSON.stringify(merchantData.products)}

## å›¾ç‰‡ï¼ˆæŒ‰é¡ºåºä½¿ç”¨ï¼‰
${JSON.stringify(merchantData.images, null, 2)}

## è¦æ±‚
1. å“ç‰Œå…³é”®è¯å‡ºç°æ¬¡æ•°: ${keywordCount}æ¬¡ï¼ˆè‡ªç„¶åˆ†å¸ƒï¼Œä¸è¦å †ç Œï¼‰
2. è¿½è¸ªé“¾æ¥: ${trackingLink}ï¼ˆåœ¨å“ç‰Œåå’Œäº§å“åä¸Šä½¿ç”¨æ­¤é“¾æ¥ï¼‰
3. æ–‡ç« ç¯‡å¹…: 800-1200å­—
4. è¯­è¨€: è‹±æ–‡
5. æ–‡ç« ç»“æ„: å¼•è¨€ + 3-5ä¸ªå°èŠ‚ + ç»“è®º
6. åœ¨æ­£æ–‡ä¸­æ’å…¥å›¾ç‰‡ï¼Œä½¿ç”¨å¯¹åº”çš„å›¾ç‰‡URL
7. è¯­è¨€é£æ ¼: è‡ªç„¶ã€æœ‰ä¸ªäººæ„Ÿå—ã€åƒçœŸäººå†™çš„ï¼Œé¿å…AIç—•è¿¹

## å†™ä½œåŸåˆ™
âœ… åšåˆ°ï¼šç¼–è¾‘è§†è§’ã€ä¸ªäººæ•…äº‹ã€ç”Ÿæ´»åŒ–è¯­è¨€ã€çœŸå®çœ‹æ³•
âŒ é¿å…ï¼šå¼€å¤´æå“ç‰Œã€ç¡¬å¹¿è¯­æ°”ã€AIå¥—è¯ï¼ˆå¦‚revolutionizingã€game-changerã€elevateï¼‰

## è¾“å‡ºæ ¼å¼
è¯·ä»¥JSONæ ¼å¼è¿”å›:
{
  "title": "æ–‡ç« æ ‡é¢˜",
  "slug": "url-friendly-slug",
  "category": "åˆ†ç±»ä»£ç ",
  "categoryName": "åˆ†ç±»åç§°",
  "excerpt": "150å­—ä»¥å†…æ‘˜è¦",
  "content": "HTMLæ ¼å¼æ­£æ–‡ï¼ˆåŒ…å«å›¾ç‰‡æ ‡ç­¾ï¼‰",
  "products": [
    {
      "name": "äº§å“åï¼ˆå«é“¾æ¥ï¼‰",
      "description": "äº§å“æè¿°",
      "image": "äº§å“å›¾ç‰‡URL",
      "price": "ä»·æ ¼"
    }
  ]
}
`;
  }
  
  private parseJsonResult(text: string): any {
    // å°è¯•æå–JSONä»£ç å—
    const codeBlockMatch = text.match(/```(?:json)?\n?([\s\S]*?)\n?```/);
    if (codeBlockMatch) {
      return JSON.parse(codeBlockMatch[1]);
    }
    
    // å°è¯•ç›´æ¥è§£æJSONå¯¹è±¡
    const jsonMatch = text.match(/\{[\s\S]*\}/);
    if (jsonMatch) {
      return JSON.parse(jsonMatch[0]);
    }
    
    throw new Error('æ— æ³•è§£æè¿”å›çš„JSON');
  }
}
```

**åç«¯ - `workers/src/routes/ai.ts`**:

```typescript
import { Hono } from 'hono';
import { ClaudeService } from '../services/claude';
import { authMiddleware } from '../middleware/auth';

const ai = new Hono();

// æ‰€æœ‰AIæ¥å£éœ€è¦è®¤è¯
ai.use('/*', authMiddleware);

// åˆ†æå•†å®¶URLï¼ˆä½¿ç”¨ Tool Use è‡ªåŠ¨çˆ¬å–ï¼‰
ai.post('/analyze', async (c) => {
  const { url } = await c.req.json();
  
  if (!url) {
    return c.json({ success: false, error: 'è¯·æä¾›å•†å®¶URL' }, 400);
  }
  
  const claude = new ClaudeService(c.env.CLAUDE_API_KEY);
  
  try {
    console.log(`[AI] å¼€å§‹åˆ†æå•†å®¶URL: ${url}`);
    const startTime = Date.now();
    
    const data = await claude.analyzeUrl(url);
    
    const duration = ((Date.now() - startTime) / 1000).toFixed(1);
    console.log(`[AI] åˆ†æå®Œæˆï¼Œè€—æ—¶ ${duration}s`);
    
    return c.json({ 
      success: true, 
      data,
      meta: {
        analyzeTime: parseFloat(duration)
      }
    });
  } catch (error: any) {
    console.error(`[AI] åˆ†æå¤±è´¥: ${error.message}`);
    return c.json({ 
      success: false, 
      error: error.message || 'åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯•'
    }, 500);
  }
});

// ç”Ÿæˆæ–‡ç« å†…å®¹
ai.post('/generate', async (c) => {
  const params = await c.req.json();
  
  const { merchantData, trackingLink, keywordCount, promptTemplateId } = params;
  
  if (!merchantData || !trackingLink) {
    return c.json({ success: false, error: 'ç¼ºå°‘å¿…è¦å‚æ•°' }, 400);
  }
  
  // è·å–æç¤ºè¯æ¨¡æ¿
  let promptTemplate = '';
  if (promptTemplateId) {
    const template = await c.env.DB
      .prepare('SELECT template_content FROM prompt_templates WHERE id = ?')
      .bind(promptTemplateId)
      .first();
    if (template) {
      promptTemplate = template.template_content as string;
    }
  }
  
  const claude = new ClaudeService(c.env.CLAUDE_API_KEY);
  
  try {
    console.log(`[AI] å¼€å§‹ç”Ÿæˆæ–‡ç« ï¼Œå“ç‰Œ: ${merchantData.brandName}`);
    const startTime = Date.now();
    
    const article = await claude.generateArticle({
      merchantData,
      trackingLink,
      keywordCount: keywordCount || 10,
      promptTemplate
    });
    
    const duration = ((Date.now() - startTime) / 1000).toFixed(1);
    console.log(`[AI] æ–‡ç« ç”Ÿæˆå®Œæˆï¼Œè€—æ—¶ ${duration}s`);
    
    return c.json({ 
      success: true, 
      data: article,
      meta: {
        generateTime: parseFloat(duration)
      }
    });
  } catch (error: any) {
    console.error(`[AI] ç”Ÿæˆå¤±è´¥: ${error.message}`);
    return c.json({ 
      success: false, 
      error: error.message || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•'
    }, 500);
  }
});

// é‡æ–°ç”Ÿæˆéƒ¨åˆ†å†…å®¹ï¼ˆå¦‚æ ‡é¢˜ã€æ‘˜è¦ï¼‰
ai.post('/regenerate', async (c) => {
  const { field, currentContent, merchantData } = await c.req.json();
  
  const claude = new ClaudeService(c.env.CLAUDE_API_KEY);
  
  try {
    const result = await claude.regenerateField(field, currentContent, merchantData);
    return c.json({ success: true, data: result });
  } catch (error: any) {
    return c.json({ success: false, error: error.message }, 500);
  }
});

export default ai;
```

#### 5.2.4 ç±»å‹å®šä¹‰

**`workers/src/types/ai.ts`**:

```typescript
// å•†å®¶æ•°æ®ç»“æ„
export interface MerchantData {
  url?: string;
  brandName: string;
  brandDescription: string;
  productType: string;
  products: Product[];
  images: ImageData[];
  categorySuggestion: string;
}

export interface Product {
  name: string;
  price: string;
  description: string;
  image?: string;
}

export interface ImageData {
  url: string;
  type: 'hero' | 'content';
  alt: string;
  width?: number;
  height?: number;
}

// æ–‡ç« ç”Ÿæˆå‚æ•°
export interface GenerateParams {
  merchantData: MerchantData;
  trackingLink: string;
  keywordCount: number;
  promptTemplate?: string;
}

// ç”Ÿæˆçš„æ–‡ç« æ•°æ®
export interface ArticleData {
  title: string;
  slug: string;
  category: string;
  categoryName: string;
  excerpt: string;
  content: string;
  images: {
    hero: ImageData;
    content: ImageData[];
  };
  products: Product[];
}
```

#### 5.2.5 å‚è€ƒæ–‡æ¡£

- éœ²å‡ºæç¤ºè¯.txt - AIæç¤ºè¯æ¨¡æ¿
- éœ²å‡ºæŒ‡å—.txt - å†…å®¹åˆ›ä½œè§„èŒƒ
- ã€éœ²å‡ºå¹³å°ã€‘åè¯å®šä¹‰å‚è€ƒæ‰‹å†Œ.md - ä¸€ã€æ ¸å¿ƒä¸šåŠ¡æœ¯è¯­

---

### 5.3 æ¨¡å—ä¸‰ï¼šå›¾ç‰‡ç®¡ç†

#### 5.3.1 åŠŸèƒ½è¯´æ˜

1. ä»å•†å®¶URLè‡ªåŠ¨è·å–5å¼ å›¾ç‰‡
2. æ¯æ—¥04:00æ£€æµ‹å¤–é“¾æœ‰æ•ˆæ€§
3. å¤±æ•ˆå‘Šè­¦å’Œå¤„ç†

#### 5.3.2 å®ç°è¦ç‚¹

**åç«¯ - `workers/src/services/imageChecker.ts`**:

```typescript
export class ImageChecker {
  private db: D1Database;
  
  constructor(db: D1Database) {
    this.db = db;
  }
  
  // æ£€æµ‹å•å¼ å›¾ç‰‡
  async checkImage(url: string): Promise<ImageStatus> {
    try {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 10000); // 10ç§’è¶…æ—¶
      
      const response = await fetch(url, {
        method: 'HEAD',
        signal: controller.signal
      });
      
      clearTimeout(timeout);
      
      const contentType = response.headers.get('content-type') || '';
      const isImage = contentType.startsWith('image/');
      
      return {
        status: response.ok && isImage ? 'valid' : 'invalid',
        httpStatus: response.status,
        contentType
      };
    } catch (error) {
      if (error.name === 'AbortError') {
        return { status: 'timeout', httpStatus: 0 };
      }
      return { status: 'invalid', httpStatus: 0, error: error.message };
    }
  }
  
  // æ‰¹é‡æ£€æµ‹ï¼ˆæ¯æ—¥å®šæ—¶ä»»åŠ¡è°ƒç”¨ï¼‰
  async checkAllImages(): Promise<CheckResult> {
    // 1. è·å–æ‰€æœ‰å¤–é“¾å›¾ç‰‡
    const images = await this.db
      .prepare(`
        SELECT * FROM image_checks 
        WHERE status != 'local' 
        ORDER BY last_check ASC
      `)
      .all();
    
    const results = {
      total: images.results.length,
      valid: 0,
      invalid: 0,
      alerts: []
    };
    
    // 2. å¹¶å‘æ£€æµ‹ï¼ˆé™åˆ¶å¹¶å‘æ•°ä¸º10ï¼‰
    const batchSize = 10;
    for (let i = 0; i < images.results.length; i += batchSize) {
      const batch = images.results.slice(i, i + batchSize);
      
      await Promise.all(batch.map(async (img) => {
        const status = await this.checkImage(img.url);
        
        // æ›´æ–°çŠ¶æ€
        await this.db
          .prepare(`
            UPDATE image_checks 
            SET status = ?, http_status = ?, last_check = datetime('now')
            WHERE id = ?
          `)
          .bind(status.status, status.httpStatus, img.id)
          .run();
        
        if (status.status === 'valid') {
          results.valid++;
        } else {
          results.invalid++;
          results.alerts.push({
            article_id: img.article_id,
            image_type: img.image_type,
            url: img.url,
            status: status.status
          });
        }
      }));
    }
    
    // 3. åˆ›å»ºå‘Šè­¦è®°å½•
    for (const alert of results.alerts) {
      await this.createAlert(alert);
    }
    
    return results;
  }
  
  // åˆ›å»ºå‘Šè­¦
  async createAlert(data: AlertData): Promise<void> {
    await this.db
      .prepare(`
        INSERT INTO image_alerts (article_id, website_id, image_type, url, alert_type)
        SELECT ?, a.website_id, ?, ?, 'invalid'
        FROM articles a WHERE a.id = ?
      `)
      .bind(data.article_id, data.image_type, data.url, data.article_id)
      .run();
  }
  
  // ä¸‹è½½å›¾ç‰‡åˆ°GitHub
  async downloadToGitHub(articleId: number, imageType: string, githubService: GitHubService): Promise<string> {
    const image = await this.db
      .prepare('SELECT * FROM image_checks WHERE article_id = ? AND image_type = ?')
      .bind(articleId, imageType)
      .first();
    
    if (!image) throw new Error('å›¾ç‰‡ä¸å­˜åœ¨');
    
    // ä¸‹è½½å›¾ç‰‡
    const response = await fetch(image.url);
    const buffer = await response.arrayBuffer();
    const base64 = btoa(String.fromCharCode(...new Uint8Array(buffer)));
    
    // ä¸Šä¼ åˆ°GitHub
    const localPath = `images/articles/${articleId}/${imageType}.jpg`;
    await githubService.uploadFile(localPath, base64);
    
    // æ›´æ–°æ•°æ®åº“
    await this.db
      .prepare(`
        UPDATE image_checks 
        SET local_path = ?, status = 'local'
        WHERE article_id = ? AND image_type = ?
      `)
      .bind(localPath, articleId, imageType)
      .run();
    
    return localPath;
  }
}
```

**å®šæ—¶ä»»åŠ¡ - `workers/src/scheduled.ts`**:

```typescript
export default {
  // å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©04:00æ‰§è¡Œ
  async scheduled(event: ScheduledEvent, env: Env, ctx: ExecutionContext) {
    // UTCæ—¶é—´éœ€è¦è°ƒæ•´ä¸ºåŒ—äº¬æ—¶é—´04:00 = UTC 20:00 (å‰ä¸€å¤©)
    const checker = new ImageChecker(env.DB);
    
    const result = await checker.checkAllImages();
    
    console.log(`å›¾ç‰‡æ£€æµ‹å®Œæˆ: æ€»è®¡${result.total}, æœ‰æ•ˆ${result.valid}, å¤±æ•ˆ${result.invalid}`);
    
    // å‘é€å‘Šè­¦é€šçŸ¥ï¼ˆå¦‚æœæœ‰å¤±æ•ˆå›¾ç‰‡ï¼‰
    if (result.alerts.length > 0) {
      // TODO: å‘é€é‚®ä»¶æˆ–å…¶ä»–é€šçŸ¥
    }
  }
};
```

**wrangler.toml æ·»åŠ å®šæ—¶ä»»åŠ¡**:

```toml
[triggers]
crons = ["0 20 * * *"]  # UTC 20:00 = åŒ—äº¬æ—¶é—´ 04:00
```

#### 5.3.3 å‚è€ƒæ–‡æ¡£

- ã€éœ²å‡ºå¹³å°ã€‘åè¯å®šä¹‰å‚è€ƒæ‰‹å†Œ.md - æ–‡ç« å›¾ç‰‡ä½“ç³»
- ã€éœ²å‡ºå¹³å°ã€‘å¼€å‘æ–¹æ¡ˆ.md - 2.2.5 å›¾ç‰‡å¤–é“¾æ£€æµ‹

---

### 5.4 æ¨¡å—å››ï¼šGitHubå‘å¸ƒ

#### 5.4.1 åŠŸèƒ½è¯´æ˜

1. ç”Ÿæˆæ–‡ç« JSONæ–‡ä»¶
2. æ›´æ–°ç´¢å¼•æ–‡ä»¶
3. æ¨é€åˆ°GitHubä»“åº“
4. è®°å½•å‘å¸ƒæ—¥å¿—

#### 5.4.2 å®ç°è¦ç‚¹

**åç«¯ - `workers/src/services/github.ts`**:

```typescript
export class GitHubService {
  private token: string;
  private owner: string = 'starrats111';
  
  constructor(token: string) {
    this.token = token;
  }
  
  // è·å–æ–‡ä»¶å†…å®¹
  async getFile(repo: string, path: string): Promise<{ content: string; sha: string } | null> {
    const response = await fetch(
      `https://api.github.com/repos/${this.owner}/${repo}/contents/${path}`,
      {
        headers: {
          'Authorization': `Bearer ${this.token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      }
    );
    
    if (!response.ok) {
      if (response.status === 404) return null;
      throw new Error(`GitHub API error: ${response.status}`);
    }
    
    const data = await response.json();
    return {
      content: atob(data.content),
      sha: data.sha
    };
  }
  
  // ä¸Šä¼ /æ›´æ–°æ–‡ä»¶
  async uploadFile(repo: string, path: string, content: string, message: string, sha?: string): Promise<void> {
    const body: any = {
      message,
      content: btoa(unescape(encodeURIComponent(content))), // Base64ç¼–ç 
    };
    
    if (sha) {
      body.sha = sha; // æ›´æ–°å·²å­˜åœ¨çš„æ–‡ä»¶éœ€è¦sha
    }
    
    const response = await fetch(
      `https://api.github.com/repos/${this.owner}/${repo}/contents/${path}`,
      {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${this.token}`,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      }
    );
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(`GitHub upload failed: ${error.message}`);
    }
  }
  
  // å‘å¸ƒæ–‡ç« 
  async publishArticle(repo: string, article: Article): Promise<PublishResult> {
    const articlePath = `js/articles/${article.id}.json`;
    const indexPath = 'js/articles-index.js';
    
    // 1. ä¸Šä¼ æ–‡ç« JSON
    const articleContent = JSON.stringify(article, null, 2);
    const existingArticle = await this.getFile(repo, articlePath);
    
    await this.uploadFile(
      repo,
      articlePath,
      articleContent,
      `æ–°å¢æ–‡ç« : ${article.title}`,
      existingArticle?.sha
    );
    
    // 2. æ›´æ–°ç´¢å¼•æ–‡ä»¶
    const indexFile = await this.getFile(repo, indexPath);
    if (indexFile) {
      const newIndex = this.updateIndex(indexFile.content, article);
      await this.uploadFile(
        repo,
        indexPath,
        newIndex,
        `æ›´æ–°ç´¢å¼•: æ·»åŠ  ${article.id}`,
        indexFile.sha
      );
    }
    
    return {
      success: true,
      articlePath,
      indexPath
    };
  }
  
  // æ›´æ–°ç´¢å¼•
  private updateIndex(currentIndex: string, article: Article): string {
    // è§£æå½“å‰ç´¢å¼•
    const match = currentIndex.match(/const articlesIndex = (\[[\s\S]*?\]);/);
    if (!match) throw new Error('æ— æ³•è§£æç´¢å¼•æ–‡ä»¶');
    
    const indexArray = JSON.parse(match[1]);
    
    // åˆ›å»ºç´¢å¼•æ¡ç›®
    const indexEntry = {
      id: article.id,
      title: article.title,
      slug: article.slug,
      category: article.category,
      categoryName: article.categoryName,
      date: article.date,
      image: article.images?.hero?.url || article.image,
      excerpt: article.excerpt,
      featured: article.featured || false,
      hasProducts: !!(article.products && article.products.length > 0)
    };
    
    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
    const existingIndex = indexArray.findIndex((a: any) => a.id === article.id);
    if (existingIndex >= 0) {
      indexArray[existingIndex] = indexEntry;
    } else {
      indexArray.unshift(indexEntry); // æ–°æ–‡ç« æ”¾åœ¨æœ€å‰é¢
    }
    
    // é‡æ–°ç”Ÿæˆç´¢å¼•æ–‡ä»¶
    return `// æ–‡ç« ç´¢å¼• - æ›´æ–°äº ${new Date().toISOString()}
// åˆ—è¡¨é¡µä½¿ç”¨æ­¤æ–‡ä»¶ï¼Œè¯¦æƒ…é¡µæŒ‰éœ€åŠ è½½ articles/*.json

const articlesIndex = ${JSON.stringify(indexArray, null, 2)};
`;
  }
}
```

#### 5.4.3 å‚è€ƒæ–‡æ¡£

- ã€å®Œæ•´è¿ç§»æ–¹æ¡ˆã€‘å…¨éƒ¨ç½‘ç«™.md - è¿ç§»åæ•°æ®ç»“æ„
- ã€éœ²å‡ºå¹³å°ã€‘åè¯å®šä¹‰å‚è€ƒæ‰‹å†Œ.md - å…­ã€æ•°æ®ç»“æ„æœ¯è¯­

---

### 5.5 æ¨¡å—äº”ï¼šå®¡æ ¸ç®¡ç†

#### 5.5.1 åŠŸèƒ½è¯´æ˜

1. å¾…å®¡æ ¸åˆ—è¡¨å±•ç¤º
2. å®¡æ ¸é€šè¿‡/é©³å›æ“ä½œ
3. è‡ªæ£€æ¨¡å¼ï¼ˆå®¡æ ¸å‘˜è·³è¿‡å®¡æ ¸ï¼‰

#### 5.5.2 å®ç°è¦ç‚¹

**åç«¯ - `workers/src/routes/reviews.ts`**:

```typescript
import { Hono } from 'hono';

const reviews = new Hono();

// è·å–å¾…å®¡æ ¸åˆ—è¡¨
reviews.get('/', async (c) => {
  const user = c.get('user');
  
  // ä»…å®¡æ ¸å‘˜å’Œç®¡ç†å‘˜å¯è®¿é—®
  if (!['admin', 'reviewer'].includes(user.role)) {
    return c.json({ error: 'æ— æƒé™' }, 403);
  }
  
  const articles = await c.env.DB
    .prepare(`
      SELECT a.*, u.name as author_name, w.name as website_name
      FROM articles a
      JOIN users u ON a.author_id = u.id
      JOIN websites w ON a.website_id = w.id
      WHERE a.status = 'pending'
      ORDER BY a.created_at DESC
    `)
    .all();
  
  return c.json({ data: articles.results });
});

// å®¡æ ¸é€šè¿‡
reviews.post('/:id/approve', async (c) => {
  const id = c.req.param('id');
  const user = c.get('user');
  
  if (!['admin', 'reviewer'].includes(user.role)) {
    return c.json({ error: 'æ— æƒé™' }, 403);
  }
  
  // æ›´æ–°æ–‡ç« çŠ¶æ€
  await c.env.DB
    .prepare(`UPDATE articles SET status = 'approved' WHERE id = ?`)
    .bind(id)
    .run();
  
  // è®°å½•å®¡æ ¸æ—¥å¿—
  await c.env.DB
    .prepare(`
      INSERT INTO reviews (article_id, reviewer_id, status)
      VALUES (?, ?, 'approved')
    `)
    .bind(id, user.id)
    .run();
  
  return c.json({ success: true });
});

// å®¡æ ¸é©³å›
reviews.post('/:id/reject', async (c) => {
  const id = c.req.param('id');
  const { comment } = await c.req.json();
  const user = c.get('user');
  
  if (!['admin', 'reviewer'].includes(user.role)) {
    return c.json({ error: 'æ— æƒé™' }, 403);
  }
  
  await c.env.DB
    .prepare(`UPDATE articles SET status = 'rejected' WHERE id = ?`)
    .bind(id)
    .run();
  
  await c.env.DB
    .prepare(`
      INSERT INTO reviews (article_id, reviewer_id, status, comment)
      VALUES (?, ?, 'rejected', ?)
    `)
    .bind(id, user.id, comment)
    .run();
  
  return c.json({ success: true });
});

export default reviews;
```

#### 5.5.3 å‚è€ƒæ–‡æ¡£

- ã€éœ²å‡ºå¹³å°ã€‘å¼€å‘æ–¹æ¡ˆ.md - 2.2.2 å®¡æ ¸ç®¡ç†
- ã€éœ²å‡ºå¹³å°ã€‘åè¯å®šä¹‰å‚è€ƒæ‰‹å†Œ.md - å››ã€å¹³å°åŠŸèƒ½æœ¯è¯­

---

## å…­ã€APIæ¥å£è§„èŒƒ

### 6.1 åŸºç¡€è§„èŒƒ

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| åŸºç¡€è·¯å¾„ | `/api` |
| è¯·æ±‚æ ¼å¼ | `application/json` |
| å“åº”æ ¼å¼ | `application/json` |
| è®¤è¯æ–¹å¼ | `Authorization: Bearer <token>` |
| æ—¶é—´æ ¼å¼ | ISO 8601 (`2026-02-13T10:30:00Z`) |

### 6.2 å“åº”æ ¼å¼

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"
}
```

**åˆ†é¡µå“åº”**:
```json
{
  "success": true,
  "data": [ ... ],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "æœªæˆæƒè®¿é—®"
  }
}
```

### 6.3 é”™è¯¯ç 

| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|--------|------------|------|
| `UNAUTHORIZED` | 401 | æœªç™»å½•æˆ–tokenæ— æ•ˆ |
| `FORBIDDEN` | 403 | æ— æƒé™ |
| `NOT_FOUND` | 404 | èµ„æºä¸å­˜åœ¨ |
| `VALIDATION_ERROR` | 400 | å‚æ•°éªŒè¯å¤±è´¥ |
| `INTERNAL_ERROR` | 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### 6.4 å®Œæ•´æ¥å£åˆ—è¡¨

è¯¦è§ï¼š**ã€éœ²å‡ºå¹³å°ã€‘å¼€å‘æ–¹æ¡ˆ.md - å››ã€APIè®¾è®¡**

---

## ä¸ƒã€æ•°æ®åº“è®¾è®¡

### 7.1 è¡¨ç»“æ„

è¯¦è§ï¼š**ã€éœ²å‡ºå¹³å°ã€‘å¼€å‘æ–¹æ¡ˆ.md - 3.3 æ•°æ®åº“è®¾è®¡**

### 7.2 åˆå§‹åŒ–SQL

**`workers/schema.sql`**:

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT NOT NULL UNIQUE,
  email TEXT,
  role TEXT DEFAULT 'editor',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ç½‘ç«™è¡¨
CREATE TABLE IF NOT EXISTS websites (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  owner_id INTEGER REFERENCES users(id),
  github_repo TEXT NOT NULL,
  data_path TEXT DEFAULT 'js/articles',
  has_products BOOLEAN DEFAULT TRUE,
  site_url TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- æ–‡ç« è¡¨
CREATE TABLE IF NOT EXISTS articles (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  website_id INTEGER REFERENCES websites(id),
  author_id INTEGER REFERENCES users(id),
  title TEXT NOT NULL,
  slug TEXT,
  category TEXT,
  category_name TEXT,
  excerpt TEXT,
  content TEXT,
  images TEXT,  -- JSONæ ¼å¼å­˜å‚¨
  products TEXT, -- JSONæ ¼å¼å­˜å‚¨
  merchant_url TEXT,
  tracking_link TEXT,
  brand_keyword TEXT,
  keyword_count INTEGER DEFAULT 10,
  status TEXT DEFAULT 'draft',
  publish_date DATE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  published_at DATETIME
);

-- å®¡æ ¸è®°å½•è¡¨
CREATE TABLE IF NOT EXISTS reviews (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  article_id INTEGER REFERENCES articles(id),
  reviewer_id INTEGER REFERENCES users(id),
  status TEXT NOT NULL,
  comment TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- å‘å¸ƒæ—¥å¿—è¡¨
CREATE TABLE IF NOT EXISTS publish_logs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  article_id INTEGER REFERENCES articles(id),
  website_id INTEGER REFERENCES websites(id),
  operator_id INTEGER REFERENCES users(id),
  commit_sha TEXT,
  status TEXT,
  error_message TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- å›¾ç‰‡æ£€æµ‹è®°å½•è¡¨
CREATE TABLE IF NOT EXISTS image_checks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  article_id INTEGER REFERENCES articles(id),
  image_type TEXT NOT NULL,
  url TEXT NOT NULL,
  local_path TEXT,
  status TEXT DEFAULT 'unchecked',
  http_status INTEGER,
  last_check DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- å›¾ç‰‡å‘Šè­¦è¡¨
CREATE TABLE IF NOT EXISTS image_alerts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  article_id INTEGER REFERENCES articles(id),
  website_id INTEGER REFERENCES websites(id),
  image_type TEXT NOT NULL,
  url TEXT NOT NULL,
  alert_type TEXT NOT NULL,
  is_resolved BOOLEAN DEFAULT FALSE,
  resolved_at DATETIME,
  resolved_by INTEGER REFERENCES users(id),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- åˆå§‹åŒ–ç”¨æˆ·æ•°æ®
INSERT INTO users (id, username, role) VALUES
(1, 'wj01', 'editor'),
(2, 'wj02', 'reviewer'),
(3, 'wj03', 'editor'),
(4, 'wj04', 'editor'),
(5, 'wj05', 'editor'),
(6, 'wj06', 'editor'),
(7, 'wj07', 'admin'),
(9, 'wj09', 'editor'),
(10, 'wj10', 'editor');

-- åˆå§‹åŒ–ç½‘ç«™æ•°æ®
INSERT INTO websites (id, name, owner_id, github_repo, site_url) VALUES
(1, 'EverydayHaven', 1, 'EverydayHaven', 'https://everydayhaven.top'),
(2, 'Quiblo', 2, 'Quiblo', 'https://quiblo.top'),
(3, 'Kivanta', 3, 'Kivanta', 'https://kivanta.top'),
(4, 'NovaNest', 4, 'NovaNest', 'https://novanest.one'),
(5, 'Zontri', 5, 'Zontri', 'https://zontri.top'),
(6, 'AlluraHub', 6, 'AlluraHub', 'https://allurahub.top'),
(7, 'VitaHaven', 7, 'VitaHaven', 'https://vitahaven.click'),
(9, 'BloomRoots', 9, 'BloomRoots', 'https://bloomroots.top'),
(10, 'VitaSphere', 10, 'VitaSphere', 'https://vitasphere.top');
```

**åˆå§‹åŒ–æ•°æ®åº“**:
```bash
wrangler d1 execute luchu-db --file=./schema.sql
```

---

## å…«ã€å‰ç«¯å¼€å‘

### 8.1 UIè®¾è®¡è§„èŒƒ

è¯¦è§ï¼š**ã€éœ²å‡ºå¹³å°ã€‘UIè®¾è®¡æŒ‡å—.md**

### 8.2 å…³é”®é¡µé¢å®ç°

#### 8.2.1 å†…å®¹åˆ›å»ºé¡µé¢

**`frontend/src/pages/Create.tsx`**:

```tsx
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { aiService } from '@/services/ai';
import { articlesService } from '@/services/articles';

export default function Create() {
  const navigate = useNavigate();
  const [step, setStep] = useState<'input' | 'preview' | 'edit'>('input');
  const [loading, setLoading] = useState(false);
  
  const [formData, setFormData] = useState({
    merchantUrl: '',
    trackingLink: '',
    websiteId: '',
    keywordCount: 10,
    publishDate: getDefaultPublishDate() // é»˜è®¤7å¤©å‰
  });
  
  const [merchantData, setMerchantData] = useState(null);
  const [articleData, setArticleData] = useState(null);
  
  // åˆ†æå•†å®¶URL
  const handleAnalyze = async () => {
    setLoading(true);
    try {
      const data = await aiService.analyze(formData.merchantUrl);
      setMerchantData(data);
      setStep('preview');
    } catch (error) {
      alert('åˆ†æå¤±è´¥: ' + error.message);
    } finally {
      setLoading(false);
    }
  };
  
  // AIç”Ÿæˆå†…å®¹
  const handleGenerate = async () => {
    setLoading(true);
    try {
      const article = await aiService.generate({
        merchantData,
        trackingLink: formData.trackingLink,
        keywordCount: formData.keywordCount,
        websiteId: formData.websiteId
      });
      setArticleData(article);
      setStep('edit');
    } catch (error) {
      alert('ç”Ÿæˆå¤±è´¥: ' + error.message);
    } finally {
      setLoading(false);
    }
  };
  
  // ä¿å­˜æ–‡ç« 
  const handleSave = async (status: 'draft' | 'pending') => {
    setLoading(true);
    try {
      await articlesService.create({
        ...articleData,
        ...formData,
        status
      });
      navigate('/articles');
    } catch (error) {
      alert('ä¿å­˜å¤±è´¥: ' + error.message);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-2xl font-semibold mb-6">åˆ›å»ºéœ²å‡ºå†…å®¹</h1>
      
      {step === 'input' && (
        <InputStep 
          formData={formData}
          onChange={setFormData}
          onAnalyze={handleAnalyze}
          loading={loading}
        />
      )}
      
      {step === 'preview' && (
        <PreviewStep
          merchantData={merchantData}
          onBack={() => setStep('input')}
          onGenerate={handleGenerate}
          loading={loading}
        />
      )}
      
      {step === 'edit' && (
        <EditStep
          articleData={articleData}
          onChange={setArticleData}
          onSaveDraft={() => handleSave('draft')}
          onSubmit={() => handleSave('pending')}
          loading={loading}
        />
      )}
    </div>
  );
}

function getDefaultPublishDate() {
  const date = new Date();
  date.setDate(date.getDate() - 7);
  return date.toISOString().split('T')[0];
}
```

### 8.3 ç»„ä»¶å¼€å‘è§„èŒƒ

1. **æ–‡ä»¶å‘½å**: PascalCase (`ArticleList.tsx`)
2. **ç»„ä»¶å¯¼å‡º**: é»˜è®¤å¯¼å‡º
3. **Propsç±»å‹**: å•ç‹¬å®šä¹‰interface
4. **æ ·å¼**: ä½¿ç”¨Tailwind CSSç±»
5. **çŠ¶æ€ç®¡ç†**: ç®€å•çŠ¶æ€ç”¨useStateï¼Œå¤æ‚çŠ¶æ€ç”¨Zustand

---

## ä¹ã€éƒ¨ç½²æµç¨‹

### 9.1 å¼€å‘ç¯å¢ƒ

```bash
# å‰ç«¯å¼€å‘
cd frontend
pnpm dev

# åç«¯å¼€å‘
cd workers
wrangler dev
```

### 9.2 ç”Ÿäº§éƒ¨ç½²

#### 9.2.1 åç«¯éƒ¨ç½²

```bash
cd workers

# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆé¦–æ¬¡ï¼‰
wrangler d1 execute luchu-db --file=./schema.sql --remote

# éƒ¨ç½²Worker
wrangler deploy
```

#### 9.2.2 å‰ç«¯éƒ¨ç½²

```bash
cd frontend

# æ„å»º
pnpm build

# éƒ¨ç½²åˆ°Cloudflare Pages
# æ–¹å¼1: é€šè¿‡GitHubè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰
# æ–¹å¼2: æ‰‹åŠ¨éƒ¨ç½²
wrangler pages deploy dist
```

### 9.3 CI/CDé…ç½®

**`.github/workflows/deploy.yml`**:

```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy-worker:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          workingDirectory: workers
          command: deploy

  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - run: cd frontend && pnpm install && pnpm build
      - uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          command: pages deploy frontend/dist --project-name=luchu-platform
```

---

## åã€å‚è€ƒæ–‡æ¡£

### 10.1 é¡¹ç›®æ–‡æ¡£

| æ–‡æ¡£ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| éœ²å‡ºæŒ‡å— | `docs/éœ²å‡ºæŒ‡å—.txt` | å†…å®¹åˆ›ä½œè§„èŒƒ |
| éœ²å‡ºæç¤ºè¯ | `docs/éœ²å‡ºæç¤ºè¯.txt` | AIç”Ÿæˆæç¤ºè¯æ¨¡æ¿ |
| å¼€å‘æ–¹æ¡ˆ | `docs/ã€éœ²å‡ºå¹³å°ã€‘å¼€å‘æ–¹æ¡ˆ.md` | è¯¦ç»†æŠ€æœ¯è®¾è®¡ |
| UIè®¾è®¡æŒ‡å— | `docs/ã€éœ²å‡ºå¹³å°ã€‘UIè®¾è®¡æŒ‡å—.md` | ç•Œé¢è®¾è®¡è§„èŒƒ |
| åè¯æ‰‹å†Œ | `docs/ã€éœ²å‡ºå¹³å°ã€‘åè¯å®šä¹‰å‚è€ƒæ‰‹å†Œ.md` | æœ¯è¯­å®šä¹‰ |
| è¿ç§»æ–¹æ¡ˆ | `migration-tools/ã€å®Œæ•´è¿ç§»æ–¹æ¡ˆã€‘å…¨éƒ¨ç½‘ç«™.md` | æ•°æ®è¿ç§» |

### 10.2 å¤–éƒ¨æ–‡æ¡£

| æ–‡æ¡£ | é“¾æ¥ |
|------|------|
| Claude API | https://docs.anthropic.com |
| GitHub API | https://docs.github.com/en/rest |
| Cloudflare Workers | https://developers.cloudflare.com/workers |
| Cloudflare D1 | https://developers.cloudflare.com/d1 |
| Hono | https://hono.dev |
| React | https://react.dev |
| Tailwind CSS | https://tailwindcss.com |
| shadcn/ui | https://ui.shadcn.com |

### 10.3 å¼€å‘æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] ä»£ç é€šè¿‡TypeScriptç±»å‹æ£€æŸ¥
- [ ] ä»£ç é€šè¿‡ESLintæ£€æŸ¥
- [ ] æ–°åŠŸèƒ½æœ‰å¯¹åº”çš„APIæ–‡æ¡£
- [ ] æ•°æ®åº“å˜æ›´æœ‰migrationè„šæœ¬
- [ ] æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] é”™è¯¯æœ‰åˆé€‚çš„å¤„ç†å’Œæ—¥å¿—
- [ ] å‰ç«¯é¡µé¢åœ¨ç§»åŠ¨ç«¯æ­£å¸¸æ˜¾ç¤º

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-13  
**ç»´æŠ¤äºº**: wj07

> ğŸ’¡ å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»wj07ã€‚

