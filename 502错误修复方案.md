# 502é”™è¯¯ä¿®å¤æ–¹æ¡ˆ

## ğŸ” é—®é¢˜è¯Šæ–­

### é”™è¯¯ç°è±¡
- **é”™è¯¯ä»£ç **: 502 Bad Gateway
- **æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨**: `/home/admin/Google-Data-Analysis/backend/logs/app.log`

### å¯èƒ½çš„åŸå› 
1. **åç«¯æœåŠ¡æœªè¿è¡Œ** - uvicornè¿›ç¨‹å¯èƒ½å·²åœæ­¢
2. **æ—¥å¿—ç›®å½•ä¸å­˜åœ¨** - logsç›®å½•å¯èƒ½æœªåˆ›å»º
3. **æœåŠ¡å¯åŠ¨å¤±è´¥** - ä»£ç å¯èƒ½æœ‰é”™è¯¯å¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨
4. **ç«¯å£è¢«å ç”¨** - 8000ç«¯å£å¯èƒ½è¢«å…¶ä»–è¿›ç¨‹å ç”¨

## âœ… å®Œæ•´ä¿®å¤æ­¥éª¤

### æ­¥éª¤1ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥uvicornè¿›ç¨‹
ps aux | grep uvicorn | grep -v grep

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8000 || ss -tlnp | grep 8000

# æ£€æŸ¥æœåŠ¡æ—¥å¿—ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
ls -la ~/Google-Data-Analysis/backend/run.log
```

### æ­¥éª¤2ï¼šåˆ›å»ºæ—¥å¿—ç›®å½•
```bash
cd ~/Google-Data-Analysis/backend
mkdir -p logs
touch logs/app.log logs/error.log
chmod 666 logs/*.log
```

### æ­¥éª¤3ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦æœ‰é”™è¯¯
```bash
cd ~/Google-Data-Analysis/backend
source venv/bin/activate
python -c "from app.main import app; print('ä»£ç æ£€æŸ¥é€šè¿‡')"
```

### æ­¥éª¤4ï¼šåœæ­¢æ—§è¿›ç¨‹å¹¶æ¸…ç†
```bash
cd ~/Google-Data-Analysis/backend
pkill -9 -f "uvicorn app.main:app"
sleep 3
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
find . -name "*.pyc" -delete 2>/dev/null || true
```

### æ­¥éª¤5ï¼šå¯åŠ¨æœåŠ¡
```bash
cd ~/Google-Data-Analysis/backend
source venv/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 &
sleep 5
```

### æ­¥éª¤6ï¼šéªŒè¯æœåŠ¡
```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep uvicorn | grep -v grep

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl -s http://127.0.0.1:8000/health

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
tail -n 50 ~/Google-Data-Analysis/backend/run.log
```

## ğŸš€ ä¸€é”®ä¿®å¤å‘½ä»¤ï¼ˆå¤åˆ¶ç²˜è´´ï¼‰

```bash
cd ~/Google-Data-Analysis/backend && \
mkdir -p logs && \
touch logs/app.log logs/error.log && \
chmod 666 logs/*.log && \
pkill -9 -f "uvicorn app.main:app" && \
sleep 3 && \
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true && \
find . -name "*.pyc" -delete 2>/dev/null || true && \
source venv/bin/activate && \
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 & \
sleep 5 && \
ps aux | grep uvicorn | grep -v grep && \
curl -s http://127.0.0.1:8000/health && \
echo "âœ“ æœåŠ¡å¯åŠ¨æˆåŠŸ" || \
(echo "âœ— æœåŠ¡å¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š" && tail -n 50 run.log)
```

## ğŸ”§ å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥

### æ£€æŸ¥Pythonç¯å¢ƒ
```bash
cd ~/Google-Data-Analysis/backend
source venv/bin/activate
python --version
pip list | grep -E "(fastapi|uvicorn|sqlalchemy)"
```

### æ£€æŸ¥ä»£ç è¯­æ³•
```bash
cd ~/Google-Data-Analysis/backend
source venv/bin/activate
python -m py_compile app/main.py
```

### æŸ¥çœ‹è¯¦ç»†é”™è¯¯
```bash
cd ~/Google-Data-Analysis/backend
source venv/bin/activate
uvicorn app.main:app --host 0.0.0.0 --port 8000
# ä¸è¦ç”¨nohupï¼Œç›´æ¥è¿è¡ŒæŸ¥çœ‹é”™è¯¯
```

## ğŸ“‹ å¸¸è§é—®é¢˜

### Q1: ç«¯å£8000è¢«å ç”¨
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i:8000 || netstat -tulpn | grep 8000

# æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
kill -9 $(lsof -t -i:8000) 2>/dev/null || true
```

### Q2: æƒé™é—®é¢˜
```bash
# ç¡®ä¿æœ‰æ‰§è¡Œæƒé™
chmod +x ~/Google-Data-Analysis/backend/venv/bin/uvicorn
```

### Q3: è™šæ‹Ÿç¯å¢ƒé—®é¢˜
```bash
# é‡æ–°åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœéœ€è¦ï¼‰
cd ~/Google-Data-Analysis/backend
rm -rf venv
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

## ğŸ¯ éªŒè¯æ¸…å•

- [ ] æ—¥å¿—ç›®å½•å·²åˆ›å»º
- [ ] æ—§è¿›ç¨‹å·²åœæ­¢
- [ ] æ–°è¿›ç¨‹å·²å¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥è¿”å›200
- [ ] æ—¥å¿—æ–‡ä»¶æ­£å¸¸å†™å…¥
- [ ] 502é”™è¯¯å·²è§£å†³

