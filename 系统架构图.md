# 系统架构图

## 一、整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        用户浏览器                              │
│                    (React Frontend)                          │
└───────────────────────┬─────────────────────────────────────┘
                        │ HTTPS
                        │
┌───────────────────────▼─────────────────────────────────────┐
│                      Nginx                                   │
│                  (反向代理/负载均衡)                           │
└───────┬───────────────────────────────────────┬────────────┘
        │                                         │
        │                                         │
┌───────▼─────────┐                    ┌─────────▼──────────┐
│   Frontend      │                    │     Backend        │
│   (React)       │                    │   (FastAPI)        │
│   Port: 3000    │                    │   Port: 8000       │
└─────────────────┘                    └─────────┬──────────┘
                                                  │
                                                  │
                        ┌─────────────────────────┼─────────────┐
                        │                         │             │
                        │                         │             │
                ┌───────▼──────┐        ┌────────▼──────┐     │
                │  PostgreSQL  │        │   Redis       │     │
                │   Database   │        │   (Cache)     │     │
                │   Port: 5432 │        │   Port: 6379  │     │
                └──────────────┘        └───────────────┘     │
                                                                 │
                                                        ┌────────▼──────┐
                                                        │  File Storage │
                                                        │   (uploads/)  │
                                                        └───────────────┘
```

## 二、数据流程图

### 2.1 用户登录流程

```
用户输入账号密码
    │
    ▼
前端发送登录请求
    │
    ▼
后端验证用户信息
    │
    ├─ 验证失败 → 返回错误信息
    │
    └─ 验证成功 → 生成JWT Token
            │
            ▼
    返回Token给前端
            │
            ▼
    前端存储Token
            │
            ▼
    跳转到主页面
```

### 2.2 数据上传流程

```
用户选择文件
    │
    ▼
前端验证文件格式和大小
    │
    ├─ 验证失败 → 提示错误
    │
    └─ 验证成功 → 上传文件
            │
            ▼
    后端接收文件
            │
            ▼
    保存文件到存储系统
            │
            ▼
    记录上传信息到数据库
            │
            ▼
    返回上传成功信息
            │
            ▼
    前端显示上传历史
```

### 2.3 数据分析流程

```
用户选择表1和表2数据
    │
    ▼
前端发送分析请求
    │
    ▼
后端接收分析请求
    │
    ▼
读取表1文件（谷歌广告数据）
    │
    ▼
读取表2文件（联盟数据）
    │
    ▼
数据清洗和标准化
    │
    ▼
数据匹配（按日期、广告ID等）
    │
    ▼
计算效果指标
    │
    ▼
生成表3格式的分析结果
    │
    ▼
保存分析结果到数据库
    │
    ▼
返回分析结果给前端
    │
    ▼
前端展示分析结果
```

### 2.4 数据总览流程（经理）

```
经理登录系统
    │
    ▼
访问数据总览页面
    │
    ▼
前端请求总览数据
    │
    ▼
后端查询所有员工数据
    │
    ├─ 查询上传记录
    ├─ 查询分析结果
    └─ 计算统计数据
            │
            ▼
    返回汇总数据
            │
            ▼
    前端展示：
    ├─ 统计卡片
    ├─ 员工列表
    └─ 数据图表
```

## 三、数据库关系图

```
┌─────────────┐
│    users    │
│─────────────│
│ id (PK)     │
│ username    │
│ password    │
│ role        │
│ employee_id │
└──────┬──────┘
       │
       │ 1
       │
       │ N
┌──────▼──────────────┐
│   data_uploads      │
│─────────────────────│
│ id (PK)             │
│ user_id (FK)        │
│ upload_type         │
│ file_name           │
│ file_path           │
│ upload_date         │
│ status              │
└──────┬──────────────┘
       │
       │ N
       │
       │ 1
┌──────▼──────────────────┐
│   analysis_results      │
│─────────────────────────│
│ id (PK)                 │
│ user_id (FK)            │
│ upload_id_google (FK)   │
│ upload_id_affiliate (FK)│
│ analysis_date           │
│ result_data (JSONB)     │
└─────────────────────────┘

┌─────────────────────┐
│  data_dictionary    │
│─────────────────────│
│ id (PK)             │
│ field_name          │
│ field_description   │
│ category            │
└─────────────────────┘
```

## 四、API接口架构

```
/api
├── /auth
│   ├── POST /login          # 用户登录
│   ├── POST /logout         # 用户登出
│   └── GET  /me             # 获取当前用户信息
│
├── /upload
│   ├── POST /google-ads     # 上传谷歌广告数据
│   ├── POST /affiliate      # 上传联盟数据
│   ├── GET  /history        # 获取上传历史
│   └── GET  /{id}           # 获取上传记录详情
│
├── /analysis
│   ├── POST /process        # 触发数据分析
│   ├── GET  /result/{id}    # 获取分析结果
│   ├── GET  /list           # 获取分析结果列表
│   └── GET  /export         # 导出分析结果
│
└── /dashboard
    ├── GET  /overview       # 获取总览数据（经理）
    ├── GET  /employees      # 获取所有员工数据（经理）
    ├── GET  /statistics     # 获取统计数据（经理）
    └── GET  /charts         # 获取图表数据（经理）
```

## 五、前端页面结构

```
/
├── /login                   # 登录页面
│
├── /dashboard               # 主页面（根据角色显示不同内容）
│   ├── Manager Dashboard   # 经理总览
│   └── Employee Dashboard   # 员工个人数据
│
├── /upload                  # 数据上传页面
│   ├── Google Ads Upload    # 上传表1
│   └── Affiliate Upload     # 上传表2
│
├── /analysis                # 分析结果页面
│   ├── Analysis List        # 分析结果列表
│   ├── Analysis Detail      # 分析结果详情
│   └── Data Dictionary      # 数据字典（表4、表5）
│
└── /settings                # 设置页面
    └── Profile              # 个人资料
```

## 六、技术栈架构

### 后端技术栈
```
FastAPI Application
├── SQLAlchemy (ORM)
│   └── PostgreSQL (Database)
├── Pandas (Data Processing)
│   ├── Excel Parser
│   └── CSV Parser
├── JWT (Authentication)
├── Pydantic (Data Validation)
└── Python-multipart (File Upload)
```

### 前端技术栈
```
React Application
├── React Router (Routing)
├── Redux (State Management)
├── Ant Design (UI Components)
├── ECharts (Charts)
├── Axios (HTTP Client)
└── React Query (Data Fetching)
```

## 七、安全架构

```
安全层
├── 认证层
│   ├── JWT Token验证
│   └── 密码加密（bcrypt）
├── 授权层
│   ├── 角色权限控制
│   └── API权限验证
├── 数据安全层
│   ├── SQL注入防护（ORM）
│   ├── XSS防护（前端转义）
│   └── CSRF防护
└── 文件安全层
    ├── 文件类型验证
    ├── 文件大小限制
    └── 文件存储隔离
```

## 八、部署架构

```
生产环境
├── Nginx (反向代理)
│   ├── 静态文件服务
│   ├── API代理
│   └── SSL终止
├── Docker容器
│   ├── Frontend Container
│   ├── Backend Container
│   └── Database Container
└── 存储
    ├── 数据库存储
    └── 文件存储
```

## 九、监控和日志

```
监控系统
├── 应用监控
│   ├── API响应时间
│   ├── 错误率
│   └── 请求量
├── 系统监控
│   ├── CPU使用率
│   ├── 内存使用率
│   └── 磁盘使用率
└── 日志系统
    ├── 应用日志
    ├── 访问日志
    └── 错误日志
```












