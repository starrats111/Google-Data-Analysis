# 服务器更新命令

## 1. 更新代码
```bash
cd ~/Google-Data-Analysis
git pull origin main
```

## 2. 清除Python缓存
```bash
cd ~/Google-Data-Analysis/backend
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
find . -name "*.pyc" -delete 2>/dev/null || true
```

## 3. 重启后端服务
```bash
cd ~/Google-Data-Analysis/backend
pkill -f "uvicorn app.main:app"
sleep 2
source venv/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 &
sleep 3
curl -s http://127.0.0.1:8000/health && echo "✓ 后端重启成功！" || echo "✗ 启动失败，查看日志：tail -n 50 run.log"
```

## 4. 验证服务状态
```bash
ps aux | grep uvicorn | grep -v grep
```

## 5. 查看日志（如果需要）
```bash
tail -f ~/Google-Data-Analysis/backend/run.log | grep -i "RW\|TransactionDetails"
```

## 一键执行所有步骤
```bash
cd ~/Google-Data-Analysis && \
git pull origin main && \
cd backend && \
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true && \
find . -name "*.pyc" -delete 2>/dev/null || true && \
pkill -f "uvicorn app.main:app" && \
sleep 2 && \
source venv/bin/activate && \
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > run.log 2>&1 & \
sleep 5 && \
curl -s http://127.0.0.1:8000/health && echo "✓ 后端重启成功！" || echo "✗ 启动失败，查看日志：tail -n 50 run.log"
```

